T 20 dets  2022 12:20:14 EET
edvin-System-Product-Name

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [init : Update APT cache] *************************************************
changed: [EdvinToome-3]
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [rsyslog : Configure rsyslog] *********************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp375169iz/50-telegraf.conf.j2
@@ -0,0 +1,11 @@
+
+#$ActionQueueType LinkedList # use asynchronous processing
+#$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+#$ActionResumeRetryCount -1 # infinite retries on insert failure
+#$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @EdvinToome-3:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [EdvinToome-1]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpqe2l5tmn/50-telegraf.conf.j2
@@ -0,0 +1,11 @@
+
+#$ActionQueueType LinkedList # use asynchronous processing
+#$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+#$ActionResumeRetryCount -1 # infinite retries on insert failure
+#$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @EdvinToome-3:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [EdvinToome-2]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmplzauc0bc/50-telegraf.conf.j2
@@ -0,0 +1,11 @@
+
+#$ActionQueueType LinkedList # use asynchronous processing
+#$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+#$ActionResumeRetryCount -1 # infinite retries on insert failure
+#$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @EdvinToome-3:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [EdvinToome-3]

TASK [backup : Add the user 'backup'] ******************************************
changed: [EdvinToome-3]
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [backup : Create a 2048-bit SSH key] **************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [backup : Copy known hosts] ***********************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpzqn1w5ev/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.larsenbiscuits.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [EdvinToome-1]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpp7spxai9/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.larsenbiscuits.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [EdvinToome-3]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpbhzj4y52/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.larsenbiscuits.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [EdvinToome-2]

TASK [backup : Create a directory /home/backup/restore] ************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [backup : install duplicity] **********************************************
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-3]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-2]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-1]

TASK [node_exporter : Install node_exporter] ***********************************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-2]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 231 not upgraded.
changed: [EdvinToome-1]

TASK [node_exporter : prometheus-node-exporter config] *************************
--- before: /etc/default/prometheus-node-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpzsdruswp/prometheus-node-exporter.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [EdvinToome-3]
--- before: /etc/default/prometheus-node-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpobximiic/prometheus-node-exporter.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/default/prometheus-node-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp_ajpgaqi/prometheus-node-exporter.j2
@@ -1,128 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-node-exporter supports the following options:
-#
-#  --collector.diskstats.ignored-devices="^(ram|loop|fd|(h|s|v|xv)d[a-z]|nvme\\d+n\\d+p)\\d+$"
-#                            Regexp of devices to ignore for diskstats.
-#  --collector.filesystem.ignored-mount-points="^/(dev|proc|run|sys|mnt|media|var/lib/docker)($|/)"
-#                            Regexp of mount points to ignore for filesystem
-#                            collector.
-#  --collector.filesystem.ignored-fs-types="^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$"
-#                            Regexp of filesystem types to ignore for
-#                            filesystem collector.
-#  --collector.netdev.ignored-devices="^lo$"
-#                            Regexp of net devices to ignore for netdev
-#                            collector.
-#  --collector.netstat.fields="^(.*_(InErrors|InErrs)|Ip_Forwarding|Ip(6|Ext)_(InOctets|OutOctets)|Icmp6?_(InMsgs|OutMsgs)|TcpExt_(Listen.*|Syncookies.*)|Tcp_(ActiveOpens|PassiveOpens|RetransSegs|CurrEstab)|Udp6?_(InDatagrams|OutDatagrams|NoPorts))$"
-#                            Regexp of fields to return for netstat
-#                            collector.
-#  --collector.ntp.server="127.0.0.1"
-#                            NTP server to use for ntp collector
-#  --collector.ntp.protocol-version=4
-#                            NTP protocol version
-#  --collector.ntp.server-is-local
-#                            Certify that collector.ntp.server address is the
-#                            same local host as this collector.
-#  --collector.ntp.ip-ttl=1  IP TTL to use while sending NTP query
-#  --collector.ntp.max-distance=3.46608s
-#                            Max accumulated distance to the root
-#  --collector.ntp.local-offset-tolerance=1ms
-#                            Offset between local clock and local ntpd time
-#                            to tolerate
-#  --path.procfs="/proc"     procfs mountpoint.
-#  --path.sysfs="/sys"       sysfs mountpoint.
-#  --collector.qdisc.fixtures=""
-#                            test fixtures to use for qdisc collector
-#                            end-to-end testing
-#  --collector.runit.servicedir="/etc/service"
-#                            Path to runit service directory.
-#  --collector.supervisord.url="http://localhost:9001/RPC2"
-#                            XML RPC endpoint.
-#  --collector.systemd.unit-whitelist=".+"
-#                            Regexp of systemd units to whitelist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.unit-blacklist=".+(\\.device|\\.scope|\\.slice|\\.target)"
-#                            Regexp of systemd units to blacklist. Units must
-#                            both match whitelist and not match blacklist to
-#                            be included.
-#  --collector.systemd.private
-#                            Establish a private, direct connection to
-#                            systemd without dbus.
-#  --collector.textfile.directory="/var/lib/prometheus/node-exporter"
-#                            Directory to read text files with metrics from.
-#  --collector.vmstat.fields="^(oom_kill|pgpg|pswp|pg.*fault).*"
-#                            Regexp of fields to return for vmstat collector.
-#  --collector.wifi.fixtures=""
-#                            test fixtures to use for wifi collector metrics
-#  --collector.arp           Enable the arp collector (default: enabled).
-#  --collector.bcache        Enable the bcache collector (default: enabled).
-#  --collector.bonding       Enable the bonding collector (default: enabled).
-#  --collector.buddyinfo     Enable the buddyinfo collector (default:
-#                            disabled).
-#  --collector.conntrack     Enable the conntrack collector (default:
-#                            enabled).
-#  --collector.cpu           Enable the cpu collector (default: enabled).
-#  --collector.diskstats     Enable the diskstats collector (default:
-#                            enabled).
-#  --collector.drbd          Enable the drbd collector (default: disabled).
-#  --collector.edac          Enable the edac collector (default: enabled).
-#  --collector.entropy       Enable the entropy collector (default: enabled).
-#  --collector.filefd        Enable the filefd collector (default: enabled).
-#  --collector.filesystem    Enable the filesystem collector (default:
-#                            enabled).
-#  --collector.hwmon         Enable the hwmon collector (default: enabled).
-#  --collector.infiniband    Enable the infiniband collector (default:
-#                            enabled).
-#  --collector.interrupts    Enable the interrupts collector (default:
-#                            disabled).
-#  --collector.ipvs          Enable the ipvs collector (default: enabled).
-#  --collector.ksmd          Enable the ksmd collector (default: disabled).
-#  --collector.loadavg       Enable the loadavg collector (default: enabled).
-#  --collector.logind        Enable the logind collector (default: disabled).
-#  --collector.mdadm         Enable the mdadm collector (default: enabled).
-#  --collector.meminfo       Enable the meminfo collector (default: enabled).
-#  --collector.meminfo_numa  Enable the meminfo_numa collector (default:
-#                            disabled).
-#  --collector.mountstats    Enable the mountstats collector (default:
-#                            disabled).
-#  --collector.netdev        Enable the netdev collector (default: enabled).
-#  --collector.netstat       Enable the netstat collector (default: enabled).
-#  --collector.nfs           Enable the nfs collector (default: enabled).
-#  --collector.nfsd          Enable the nfsd collector (default: enabled).
-#  --collector.ntp           Enable the ntp collector (default: disabled).
-#  --collector.qdisc         Enable the qdisc collector (default: disabled).
-#  --collector.runit         Enable the runit collector (default: disabled).
-#  --collector.sockstat      Enable the sockstat collector (default:
-#                            enabled).
-#  --collector.stat          Enable the stat collector (default: enabled).
-#  --collector.supervisord   Enable the supervisord collector (default:
-#                            disabled).
-#  --collector.systemd       Enable the systemd collector (default: enabled).
-#  --collector.tcpstat       Enable the tcpstat collector (default:
-#                            disabled).
-#  --collector.textfile      Enable the textfile collector (default:
-#                            enabled).
-#  --collector.time          Enable the time collector (default: enabled).
-#  --collector.uname         Enable the uname collector (default: enabled).
-#  --collector.vmstat        Enable the vmstat collector (default: enabled).
-#  --collector.wifi          Enable the wifi collector (default: enabled).
-#  --collector.xfs           Enable the xfs collector (default: enabled).
-#  --collector.zfs           Enable the zfs collector (default: enabled).
-#  --collector.timex         Enable the timex collector (default: enabled).
-#  --web.listen-address=":9100"
-#                            Address on which to expose metrics and web
-#                            interface.
-#  --web.telemetry-path="/metrics"
-#                            Path under which to expose metrics.
-#  --log.level="info"        Only log messages with the given severity or
-#                            above. Valid levels: [debug, info, warn, error,
-#                            fatal]
-#  --log.format="logger:stderr"
-#                            Set the log target and format. Example:
-#                            "logger:syslog?appname=bob&local=7" or
-#                            "logger:stdout?json=true"
+ARGS="--web.listen-address=':9100'"
\ No newline at end of file

changed: [EdvinToome-2]

TASK [node_exporter : Enable node exporter] ************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [users : Add the user 'juri'] *********************************************
changed: [EdvinToome-2]
changed: [EdvinToome-3]
changed: [EdvinToome-1]

TASK [users : Add the user 'roman'] ********************************************
changed: [EdvinToome-3]
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [users : juri] ************************************************************
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7TPxJ4rbrgO+cZzIzsU+PP6mk/3Njyb0dIFeCxuXWLhl2hNz5/4fzJUYxJV4ZYOE3aVLF14NrQec0uBvn4OKtCEXfBb+dNJqn8Zvqef529VexwAEha1qwCNKX4+mibYTCwX5sl2Vlu/qTQccc/ep2Te7Q561kVyl8WgpBnTrP+ogbXB5RDa1FxGx/Cwd7HN0p7RAob4efnGhpML8mrydnf0L8vvcJreAJLfjDwIdA1SYPBrSLKIrOhnncB0cEoFCbDD/LLNAG0igD3qgfu7FXEBvdFQQqj/9bxm3arg70dOb7yViqN+VHJ3sF7cnnRSuTSBuaLtSO9RJKfhaPLILDzdyl3HLnLbfmKZSqZN0nqczve8VRapLRlnKSpDDwadP4uiPuXDUAz0OwE7IYvbQUflZYiRrFZc9F6Pwp9W9PLZ+RoISY5YXWKsNbFIOTrhe2JfwoceCZgtxe5kZmlEq7I6Thd6EBPv7X/BlNZBpcgu1oaCBseQWsHkQoFcuZgLE= 

changed: [EdvinToome-3]
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7TPxJ4rbrgO+cZzIzsU+PP6mk/3Njyb0dIFeCxuXWLhl2hNz5/4fzJUYxJV4ZYOE3aVLF14NrQec0uBvn4OKtCEXfBb+dNJqn8Zvqef529VexwAEha1qwCNKX4+mibYTCwX5sl2Vlu/qTQccc/ep2Te7Q561kVyl8WgpBnTrP+ogbXB5RDa1FxGx/Cwd7HN0p7RAob4efnGhpML8mrydnf0L8vvcJreAJLfjDwIdA1SYPBrSLKIrOhnncB0cEoFCbDD/LLNAG0igD3qgfu7FXEBvdFQQqj/9bxm3arg70dOb7yViqN+VHJ3sF7cnnRSuTSBuaLtSO9RJKfhaPLILDzdyl3HLnLbfmKZSqZN0nqczve8VRapLRlnKSpDDwadP4uiPuXDUAz0OwE7IYvbQUflZYiRrFZc9F6Pwp9W9PLZ+RoISY5YXWKsNbFIOTrhe2JfwoceCZgtxe5kZmlEq7I6Thd6EBPv7X/BlNZBpcgu1oaCBseQWsHkQoFcuZgLE= 

changed: [EdvinToome-1]
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7TPxJ4rbrgO+cZzIzsU+PP6mk/3Njyb0dIFeCxuXWLhl2hNz5/4fzJUYxJV4ZYOE3aVLF14NrQec0uBvn4OKtCEXfBb+dNJqn8Zvqef529VexwAEha1qwCNKX4+mibYTCwX5sl2Vlu/qTQccc/ep2Te7Q561kVyl8WgpBnTrP+ogbXB5RDa1FxGx/Cwd7HN0p7RAob4efnGhpML8mrydnf0L8vvcJreAJLfjDwIdA1SYPBrSLKIrOhnncB0cEoFCbDD/LLNAG0igD3qgfu7FXEBvdFQQqj/9bxm3arg70dOb7yViqN+VHJ3sF7cnnRSuTSBuaLtSO9RJKfhaPLILDzdyl3HLnLbfmKZSqZN0nqczve8VRapLRlnKSpDDwadP4uiPuXDUAz0OwE7IYvbQUflZYiRrFZc9F6Pwp9W9PLZ+RoISY5YXWKsNbFIOTrhe2JfwoceCZgtxe5kZmlEq7I6Thd6EBPv7X/BlNZBpcgu1oaCBseQWsHkQoFcuZgLE= 

changed: [EdvinToome-2]

TASK [users : roman] ***********************************************************
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [EdvinToome-1]
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [EdvinToome-2]
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [EdvinToome-3]

RUNNING HANDLER [rsyslog : Restart rsyslog] ************************************
changed: [EdvinToome-3]
changed: [EdvinToome-1]
changed: [EdvinToome-2]

RUNNING HANDLER [node_exporter : Restart node exporter] ************************
changed: [EdvinToome-3]
changed: [EdvinToome-1]
changed: [EdvinToome-2]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data python3-ply
Suggested packages:
  bind-doc resolvconf python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs
2 upgraded, 5 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]

TASK [bind : Start service bind9, if not started] ******************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [bind : Configure access rules for DNS server] ****************************
changed: [EdvinToome-1]
changed: [EdvinToome-3]
changed: [EdvinToome-2]

TASK [bind : Configure conf local] *********************************************
--- before: /etc/bind/named.conf.local
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpdtnz8bg8/named.conf.local.j2
@@ -1,8 +1,21 @@
-//
-// Do any local configuration here
-//
+zone "larsenbiscuits.io" {
+    	type slave;
+	masters {
+		    192.168.43.163;
+		};
+    	file "db.larsenbiscuits.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
 
+server 192.168.43.163 {
+    keys {dns_transfer_key;};
+};
+
+
+zone "168.192.in-addr.arpa" {
+    	type slave;
+	masters {
+		    192.168.43.163;
+		};
+    	file "db.rev";
+};
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/bind/named.conf.local
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpw_dda8o5/named.conf.local.j2
@@ -1,8 +1,14 @@
-//
-// Do any local configuration here
-//
+zone "larsenbiscuits.io" {
+    	type master;
+	allow-update {key dns_update_key;};
+	allow-transfer {key dns_transfer_key;};
+		file "db.larsenbiscuits.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
 
+zone "168.192.in-addr.arpa" {
+    	type master;
+	allow-update {key dns_update_key;};
+	allow-transfer {key dns_transfer_key;};
+		file "db.rev";
+};
\ No newline at end of file

changed: [EdvinToome-3]
--- before: /etc/bind/named.conf.local
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpkn7z9gmj/named.conf.local.j2
@@ -1,8 +1,21 @@
-//
-// Do any local configuration here
-//
+zone "larsenbiscuits.io" {
+    	type slave;
+	masters {
+		    192.168.43.163;
+		};
+    	file "db.larsenbiscuits.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
 
+server 192.168.43.163 {
+    keys {dns_transfer_key;};
+};
+
+
+zone "168.192.in-addr.arpa" {
+    	type slave;
+	masters {
+		    192.168.43.163;
+		};
+    	file "db.rev";
+};
\ No newline at end of file

changed: [EdvinToome-2]

TASK [bind : Configure resolv.conf] ********************************************
--- before: /etc/resolv.conf
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp3zra89u8/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.44
+nameserver 192.168.43.40
+search larsenbiscuits.io
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/resolv.conf
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp3qtmkeok/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.44
+nameserver 192.168.43.40
+search larsenbiscuits.io
\ No newline at end of file

changed: [EdvinToome-3]
--- before: /etc/resolv.conf
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpm39z5zu_/resolv.conf.j2
@@ -1,19 +1,3 @@
-# This file is managed by man:systemd-resolved(8). Do not edit.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs must not access this file directly, but only through the
-# symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,
-# replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.43.44
+nameserver 192.168.43.40
+search larsenbiscuits.io
\ No newline at end of file

changed: [EdvinToome-2]

TASK [bind : Configure DB.larsenbiscuits.io] ***********************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpbz3o_iw4/db.larsenbiscuits.io.j2
@@ -0,0 +1,16 @@
+$TTL	604800
+larsenbiscuits.io.	IN	SOA	EdvinToome-1.larsenbiscuits.io. edvin.larsenbiscuits.io. (
+			      2		; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+larsenbiscuits.io.	IN	NS	EdvinToome-1
+larsenbiscuits.io.	IN	NS	EdvinToome-2
+larsenbiscuits.io.	IN	NS	EdvinToome-3
+
+EdvinToome-1	IN	A	192.168.43.44
+EdvinToome-2	IN	A	192.168.43.40
+EdvinToome-3	IN	A	192.168.43.163

changed: [EdvinToome-3]

TASK [bind : Configure DB rev] *************************************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpk4rfeg0y/db.rev.j2
@@ -0,0 +1,17 @@
+
+$TTL	604800
+168.192.in-addr.arpa.	IN	SOA	EdvinToome-1.larsenbiscuits.io. edvin.larsenbiscuits.io. (
+			      2		; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+168.192.in-addr.arpa.	IN	NS	EdvinToome-1.larsenbiscuits.io.
+168.192.in-addr.arpa.	IN	NS	EdvinToome-2.larsenbiscuits.io.
+168.192.in-addr.arpa.	IN	NS	EdvinToome-3.larsenbiscuits.io.
+
+44.43 IN	PTR	EdvinToome-1.larsenbiscuits.io.
+40.43 IN	PTR	EdvinToome-2.larsenbiscuits.io.
+163.43 IN	PTR	EdvinToome-3.larsenbiscuits.io.

changed: [EdvinToome-3]

TASK [bind : Force flushers] ***************************************************

RUNNING HANDLER [bind : Restart bind9] *****************************************
changed: [EdvinToome-3]
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [bind_exporter : update and install bind exporter] ************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [bind_exporter : install service] *****************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpvehzj1q7/bind_exporter.service.j2
@@ -0,0 +1,24 @@
+[Unit]
+Description=Prometheus
+Documentation=https://github.com/prometheus-community/bind_exporter
+Wants=network-online.target
+After=network-online.target
+
+[Service]
+Type=simple
+User=prometheus
+Group=prometheus
+ExecReload=/bin/kill -HUP $MAINPID
+ExecStart=/usr/local/bin/bind_exporter \
+  --bind.pid-file=/var/run/named/named.pid \
+  --bind.timeout=20s \
+  --web.listen-address=0.0.0.0:9153 \
+  --web.telemetry-path=/metrics \
+  --bind.stats-url=http://127.0.0.1:8053/ \
+  --bind.stats-groups=server,view,tasks
+
+SyslogIdentifier=prometheus
+Restart=always
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-1]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpj_33ct2z/bind_exporter.service.j2
@@ -0,0 +1,24 @@
+[Unit]
+Description=Prometheus
+Documentation=https://github.com/prometheus-community/bind_exporter
+Wants=network-online.target
+After=network-online.target
+
+[Service]
+Type=simple
+User=prometheus
+Group=prometheus
+ExecReload=/bin/kill -HUP $MAINPID
+ExecStart=/usr/local/bin/bind_exporter \
+  --bind.pid-file=/var/run/named/named.pid \
+  --bind.timeout=20s \
+  --web.listen-address=0.0.0.0:9153 \
+  --web.telemetry-path=/metrics \
+  --bind.stats-url=http://127.0.0.1:8053/ \
+  --bind.stats-groups=server,view,tasks
+
+SyslogIdentifier=prometheus
+Restart=always
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-3]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpdfu4s97o/bind_exporter.service.j2
@@ -0,0 +1,24 @@
+[Unit]
+Description=Prometheus
+Documentation=https://github.com/prometheus-community/bind_exporter
+Wants=network-online.target
+After=network-online.target
+
+[Service]
+Type=simple
+User=prometheus
+Group=prometheus
+ExecReload=/bin/kill -HUP $MAINPID
+ExecStart=/usr/local/bin/bind_exporter \
+  --bind.pid-file=/var/run/named/named.pid \
+  --bind.timeout=20s \
+  --web.listen-address=0.0.0.0:9153 \
+  --web.telemetry-path=/metrics \
+  --bind.stats-url=http://127.0.0.1:8053/ \
+  --bind.stats-groups=server,view,tasks
+
+SyslogIdentifier=prometheus
+Restart=always
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-2]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

RUNNING HANDLER [bind_exporter : restart_bind_exporter] ************************
changed: [EdvinToome-3]
changed: [EdvinToome-2]
changed: [EdvinToome-1]

PLAY [DNS master] **************************************************************

TASK [dns_records : Set CNAME records] *****************************************
changed: [EdvinToome-3] => (item={'key': 'grafana', 'value': 'EdvinToome-3'})
changed: [EdvinToome-3] => (item={'key': 'influxdb', 'value': 'EdvinToome-3'})
changed: [EdvinToome-3] => (item={'key': 'lb1', 'value': 'EdvinToome-1'})
changed: [EdvinToome-3] => (item={'key': 'lb2', 'value': 'EdvinToome-2'})
changed: [EdvinToome-3] => (item={'key': 'mysql1', 'value': 'EdvinToome-1'})
changed: [EdvinToome-3] => (item={'key': 'mysql2', 'value': 'EdvinToome-2'})
changed: [EdvinToome-3] => (item={'key': 'ns1', 'value': 'EdvinToome-1'})
changed: [EdvinToome-3] => (item={'key': 'ns2', 'value': 'EdvinToome-2'})
changed: [EdvinToome-3] => (item={'key': 'prometheus', 'value': 'EdvinToome-3'})
changed: [EdvinToome-3] => (item={'key': 'web1', 'value': 'EdvinToome-1'})
changed: [EdvinToome-3] => (item={'key': 'web2', 'value': 'EdvinToome-2'})

TASK [dns_records : Set A records] *********************************************
changed: [EdvinToome-3] => (item={'key': 'backup', 'value': '192.168.42.132'})

PLAY [Prometheus] **************************************************************

TASK [nginx : Install nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common
Suggested packages:
  libgd-tools geoip-bin fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-full
0 upgraded, 25 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-3]

TASK [nginx : NGINX config] ****************************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpni8ag4t1/default.j2
@@ -1,91 +1,24 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
+	listen 80;
 	server_name _;
 
 	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+		proxy_pass            http://localhost:8002;
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
+    listen 8080 default_server;
 
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
+	location = /stub_status {
+	    stub_status;
+	}
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    	location /prometheus {
+	    proxy_pass http://localhost:9090;
+	}
+	
+		location /grafana {
+	    proxy_set_header Host $http_host;
+	    proxy_pass http://localhost:3001;
+	}
+	}
\ No newline at end of file

changed: [EdvinToome-3]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-3]

TASK [prometheus : update and install prometheus] ******************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [prometheus : prometheus args] ********************************************
--- before: /etc/default/prometheus
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpiz8my0zt/prometheus.j2
@@ -1,57 +1 @@
-# Set the command-line arguments to pass to the server.
-ARGS=""
-
-# Prometheus supports the following options:
-#  --config.file="/etc/prometheus/prometheus.yml"
-#                             Prometheus configuration file path.
-#  --web.listen-address="0.0.0.0:9090"
-#                             Address to listen on for UI, API, and telemetry.
-#  --web.read-timeout=5m      Maximum duration before timing out read of the
-#                             request, and closing idle connections.
-#  --web.max-connections=512  Maximum number of simultaneous connections.
-#  --web.external-url=<URL>   The URL under which Prometheus is externally
-#                             reachable (for example, if Prometheus is served
-#                             via a reverse proxy). Used for generating
-#                             relative and absolute links back to Prometheus
-#                             itself. If the URL has a path portion, it will
-#                             be used to prefix all HTTP endpoints served by
-#                             Prometheus. If omitted, relevant URL components
-#                             will be derived automatically.
-#  --web.route-prefix=<path>  Prefix for the internal routes of web endpoints.
-#                             Defaults to path of --web.external-url.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#                             Path to static asset/templates directory.
-#  --web.user-assets=<path>   Path to static asset directory, available at
-#                             /user.
-#  --web.enable-lifecycle     Enable shutdown and reload via HTTP request.
-#  --web.enable-admin-api     Enables API endpoints for admin control actions.
-#  --web.console.templates="/etc/prometheus/consoles"
-#                             Path to the console template directory,
-#                             available at /consoles.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#                             Path to the console library directory.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#                             Base path for metrics storage.
-#  --storage.tsdb.min-block-duration=2h
-#                             Minimum duration of a data block before being
-#                             persisted.
-#  --storage.tsdb.max-block-duration=<duration>
-#                             Maximum duration compacted blocks may span.
-#                             (Defaults to 10% of the retention period)
-#  --storage.tsdb.retention=15d
-#                             How long to retain samples in the storage.
-#  --storage.tsdb.use-lockfile
-#                             Create a lockfile in data directory.
-#  --alertmanager.notification-queue-capacity=10000
-#                             The capacity of the queue for pending alert
-#                             manager notifications.
-#  --alertmanager.timeout=10s
-#                             Timeout for sending alerts to Alertmanager.
-#  --query.lookback-delta=5m  The delta difference allowed for retrieving
-#                             metrics during expression evaluations.
-#  --query.timeout=2m         Maximum time a query may take before being
-#                             aborted.
-#  --query.max-concurrency=20
-#                             Maximum number of queries executed concurrently.
-#  --log.level=info           Only log messages with the given severity or
-#                             above. One of: [debug, info, warn, error]
+ARGS="--web.external-url=http://193.40.156.67/prometheus --config.file /etc/prometheus/prometheus.yml --web.enable-lifecycle --storage.tsdb.retention.time=365d --web.console.templates=/etc/prometheus/consoles --web.console.libraries=/etc/prometheus/console_libraries"
\ No newline at end of file

changed: [EdvinToome-3]

TASK [prometheus : prometheus configuration file] ******************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmplzufeych/prometheus.yml.j2
@@ -1,44 +1,54 @@
-# Sample config for Prometheus.
+global:
+  evaluation_interval: 5s
+  external_labels:
+    env: production
+  scrape_interval: 30s
+scrape_configs:
+- job_name: prometheus
+  metrics_path: /prometheus/metrics
+  scrape_interval: 30s
+  static_configs:
+  - targets:
+    - localhost:9090
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
-alerting:
-  alertmanagers:
-  - static_configs:
-    - targets: ['localhost:9093']
-
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
-scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
-  - job_name: 'prometheus'
-
-    # Override the global default and scrape targets from this job every 5 seconds.
-    scrape_interval: 5s
-    scrape_timeout: 5s
-
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
-    static_configs:
-      - targets: ['localhost:9090']
-
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
-    static_configs:
-      - targets: ['localhost:9100']
+- job_name: linux
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-1:9100
+    - EdvinToome-2:9100
+    - EdvinToome-3:9100
+- job_name: bind9
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-1:9119
+    - EdvinToome-2:9119
+- job_name: nginx
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-1:9113
+    - EdvinToome-2:9113
+    - EdvinToome-3:9113
+- job_name: mysql
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-2:9104
+- job_name: influxdb
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-3:9424
+- job_name: haproxy
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-1:9101
+- job_name: keepalived
+  scrape_interval: 15s
+  static_configs:
+  - targets:
+    - EdvinToome-1:9165
+    - EdvinToome-2:9165
\ No newline at end of file

changed: [EdvinToome-3]

TASK [prometheus : start prometheus] *******************************************
ok: [EdvinToome-3]

TASK [prometheus : Install nginx] **********************************************
ok: [EdvinToome-3]

TASK [prometheus : Start service nginx, if not started] ************************
ok: [EdvinToome-3]

TASK [prometheus : Enable service nginx, and not touch the state] **************
ok: [EdvinToome-3]

TASK [nginx_exporter : update and install nginx exporter] **********************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpb93lsjcp/prometheus-nginx-exporter.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address=':9113'"
\ No newline at end of file

changed: [EdvinToome-3]

TASK [nginx_exporter : Enable nginx exporter] **********************************
changed: [EdvinToome-3]

RUNNING HANDLER [prometheus : restart_prometheus] ******************************
changed: [EdvinToome-3]

RUNNING HANDLER [prometheus : Restart nginx] ***********************************
changed: [EdvinToome-3]

RUNNING HANDLER [nginx_exporter : Restart nginx exporter] **********************
changed: [EdvinToome-3]

PLAY [Database server] *********************************************************

TASK [mysql : Install python3-pymysql] *****************************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [mysql : Install mysql-server] ********************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]

TASK [mysql : Start service mysql, if not started] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Enable service mysql, and not touch the state] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : mysql config] ****************************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp4y4cigpj/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 300
\ No newline at end of file

changed: [EdvinToome-1]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp924mua6q/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 296
\ No newline at end of file

changed: [EdvinToome-2]

TASK [mysql : MySQL database] **************************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [mysql : MySQL user] ******************************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [mysql : MySQL user replication] ******************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [mysql : MySQL read only for replica server] ******************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [mysql_exporter : update and install mysql node exporter] *****************
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [mysql_exporter : create mysql user] **************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [mysql_exporter : Enable mysql exporter] **********************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [mysql_exporter : config mysql] *******************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [mysql_exporter : config prometheus-mysqld-exporter] **********************
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpngbtp2_p/prometheus-mysqld-exporter.j2
@@ -1,120 +1 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
-
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status --web.listen-address=':9104'"
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/default/prometheus-mysqld-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpzilr2mvu/prometheus-mysqld-exporter.j2
@@ -1,120 +1 @@
-# By default the connection string will be read from
-# $HOME/my.cnf or from the file specified with the -config.my-cnf parameter.
-
-# To set a connection string from the environment instead, uncomment one of the
-# following lines.
-
-# Using UNIX domain sockets and authentication:
-# DATA_SOURCE_NAME="prometheus:nopassword@unix(/run/mysqld/mysqld.sock)/"
-
-# Using a TCP connection and password authentication:
-# DATA_SOURCE_NAME="login:password@(hostname:port)/dbname"
-
-# Note the user must be granted enough privileges for the exporter to run.
-# Example to create a user to connect with the UNIX socket:
-#
-#  CREATE USER IF NOT EXISTS 'prometheus'@'localhost' IDENTIFIED VIA unix_socket;
-#  GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'prometheus'@'localhost';
-
-# Set the command-line arguments to pass to the exporter.
-# ARGS='-config.my-cnf /etc/mysql/debian.cnf'
-
-# Usage of prometheus-mysqld-exporter:
-#   -collect.auto_increment.columns
-#     	Collect auto_increment columns and max values from information_schema
-#  --exporter.lock_wait_timeout=2
-#       Set a lock_wait_timeout on the connection to avoid long metadata
-#       locking.
-#  --exporter.log_slow_filter
-#       Add a log_slow_filter to avoid slow query logging of scrapes. NOTE: Not
-#       supported by Oracle MySQL.
-#  --collect.heartbeat.database="heartbeat"
-#       Database from where to collect heartbeat data
-#  --collect.heartbeat.table="heartbeat"
-#       Table from where to collect heartbeat data
-#  --collect.info_schema.processlist.min_time=0
-#       Minimum time a thread must be in each state to be counted
-#  --collect.info_schema.tables.databases="*"
-#       The list of databases to collect table stats for, or '*' for all
-#  --collect.perf_schema.eventsstatements.limit=250
-#       Limit the number of events statements digests by response time
-#  --collect.perf_schema.eventsstatements.timelimit=86400
-#       Limit how old the 'last_seen' events statements can be, in seconds
-#  --collect.perf_schema.eventsstatements.digest_text_limit=120
-#       Maximum length of the normalized statement text
-#  --collect.perf_schema.file_instances.filter=".*"
-#       RegEx file_name filter for performance_schema.file_summary_by_instance
-#  --collect.perf_schema.file_instances.remove_prefix="/var/lib/mysql/"
-#       Remove path prefix in performance_schema.file_summary_by_instance
-#  --web.listen-address=":9104"
-#       Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#       Path under which to expose metrics.
-#  --config.my-cnf="$HOME/.my.cnf"
-#       Path to .my.cnf file to read MySQL credentials from.
-#  --collect.global_variables
-#       Collect from SHOW GLOBAL VARIABLES
-#  --collect.slave_status
-#       Collect from SHOW SLAVE STATUS
-#  --collect.info_schema.processlist
-#       Collect current thread state counts from the
-#       information_schema.processlist
-#  --collect.info_schema.tables
-#       Collect metrics from information_schema.tables
-#  --collect.info_schema.innodb_tablespaces
-#       Collect metrics from information_schema.innodb_sys_tablespaces
-#  --collect.info_schema.innodb_metrics
-#       Collect metrics from information_schema.innodb_metrics
-#  --collect.auto_increment.columns
-#       Collect auto_increment columns and max values from information_schema
-#  --collect.global_status
-#       Collect from SHOW GLOBAL STATUS
-#  --collect.perf_schema.tableiowaits
-#       Collect metrics from performance_schema.table_io_waits_summary_by_table
-#  --collect.perf_schema.indexiowaits
-#       Collect metrics from
-#       performance_schema.table_io_waits_summary_by_index_usage
-#  --collect.perf_schema.tablelocks
-#       Collect metrics from
-#       performance_schema.table_lock_waits_summary_by_table
-#  --collect.perf_schema.eventsstatements
-#       Collect metrics from
-#       performance_schema.events_statements_summary_by_digest
-#  --collect.perf_schema.eventswaits
-#       Collect metrics from
-#       performance_schema.events_waits_summary_global_by_event_name
-#  --collect.perf_schema.file_events
-#       Collect metrics from performance_schema.file_summary_by_event_name
-#  --collect.perf_schema.file_instances
-#       Collect metrics from performance_schema.file_summary_by_instance
-#  --collect.binlog_size
-#       Collect the current size of all registered binlog files
-#  --collect.info_schema.userstats
-#       If running with userstat=1, set to true to collect user statistics
-#  --collect.info_schema.clientstats
-#       If running with userstat=1, set to true to collect client statistics
-#  --collect.info_schema.tablestats
-#       If running with userstat=1, set to true to collect table statistics
-#  --collect.info_schema.innodb_cmp
-#       Collect metrics from information_schema.innodb_cmp
-#  --collect.info_schema.innodb_cmpmem
-#       Collect metrics from information_schema.innodb_cmpmem
-#  --collect.info_schema.query_response_time
-#       Collect query response time distribution if query_response_time_stats
-#       is ON.
-#  --collect.engine_tokudb_status
-#       Collect from SHOW ENGINE TOKUDB STATUS
-#  --collect.perf_schema.replication_group_member_stats
-#       Collect metrics from performance_schema.replication_group_member_stats
-#  --collect.heartbeat
-#       Collect from heartbeat
-#  --collect.slave_hosts
-#       Scrape information from 'SHOW SLAVE HOSTS'
-#  --collect.engine_innodb_status
-#       Collect from SHOW ENGINE INNODB STATUS
-#  --log.level="info"
-#       Only log messages with the given severity or above. Valid levels:
-#       [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#       Set the log target and format. Example:
-#       "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--collect.slave_status --web.listen-address=':9104'"
\ No newline at end of file

changed: [EdvinToome-2]

TASK [mysql_backup : Create a directory /home/backup/mysql] ********************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-2]

TASK [mysql_backup : create mysql user backup] *********************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [mysql_backup : config mysql] *********************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
--- before: crontab for user "backup"
+++ after: crontab for user "backup"
@@ -0,0 +1,2 @@
+#Ansible: MySQL dump
+0 0 * * 0 mysqldump agama > /home/backup/mysql/agama.sql

changed: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
--- before: crontab for user "backup"
+++ after: crontab for user "backup"
@@ -1,2 +1,4 @@
 #Ansible: MySQL dump
 0 0 * * 0 mysqldump agama > /home/backup/mysql/agama.sql
+#Ansible: Full Duplication
+0 1 * * 0 duplicity --no-encryption full /home/backup/mysql/ rsync://EdvinToome@backup.larsenbiscuits.io/mysql

changed: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
--- before: crontab for user "backup"
+++ after: crontab for user "backup"
@@ -2,3 +2,5 @@
 0 0 * * 0 mysqldump agama > /home/backup/mysql/agama.sql
 #Ansible: Full Duplication
 0 1 * * 0 duplicity --no-encryption full /home/backup/mysql/ rsync://EdvinToome@backup.larsenbiscuits.io/mysql
+#Ansible: Incremental Duplication
+0 2 * * 0 duplicity --no-encryption incremental /home/backup/mysql/ rsync://EdvinToome@backup.larsenbiscuits.io/mysql

changed: [EdvinToome-2]

TASK [keepalived : Install keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [keepalived : Keepalived config] ******************************************
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpfalu55hb/keepalived.conf.j2
@@ -0,0 +1,21 @@
+vrrp_script check_haproxy {                 
+    script "/home/keepalived_script/script.sh" 
+    weight 20                              
+    interval 1               
+}
+vrrp_instance uni {             
+    interface ens3
+    virtual_router_id 2
+        priority 99 
+        advert_int 1                            
+    virtual_ipaddress {                     
+        192.168.101.44/24                
+    }
+    unicast_peer {                          
+        192.168.43.44
+    }
+    track_script {
+        check_haproxy
+    }
+}
+

changed: [EdvinToome-2]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmptdt0vkk6/keepalived.conf.j2
@@ -0,0 +1,21 @@
+vrrp_script check_haproxy {                 
+    script "/home/keepalived_script/script.sh" 
+    weight 20                              
+    interval 1               
+}
+vrrp_instance uni {             
+    interface ens3
+    virtual_router_id 2
+        priority 100
+        advert_int 1                            
+    virtual_ipaddress {                     
+        192.168.101.44/24                
+    }
+    unicast_peer {                          
+        192.168.43.40
+    }
+    track_script {
+        check_haproxy
+    }
+}
+

changed: [EdvinToome-1]

TASK [keepalived : Start service keepalived, if not started] *******************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [keepalived : Add keepalived_script user] *********************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [keepalived : Add keepalive script] ***************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpu2yfzukq/script.sh.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '
\ No newline at end of file

changed: [EdvinToome-1]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpocuta4b4/script.sh.j2
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '
\ No newline at end of file

changed: [EdvinToome-2]

TASK [keepalived : Enable service keepalived, and not touch the state] *********
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Create a directory /usr/local/bin/keepalived-exporter/] *****
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "mode": "0755",
+    "mode": "0777",
     "path": "/usr/local/bin/keepalived-exporter/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "mode": "0755",
+    "mode": "0777",
     "path": "/usr/local/bin/keepalived-exporter/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-2]

TASK [keepalived : download and unzip node exporter if not exist] **************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [keepalived : config keepalived exporter.service] *************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpx68eipei/keepalived-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Somedescription
+Documentation=https://github.com/romankuchin/ica0002-2022/blob/main/08-logging/README.md
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-2]
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp_athbv5a/keepalived-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Somedescription
+Documentation=https://github.com/romankuchin/ica0002-2022/blob/main/08-logging/README.md
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-1]

TASK [keepalived : Start keepalived exporter] **********************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [haproxy : Install haproxy] ***********************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [haproxy : Configure haproxy] *********************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpi062uigq/haproxy.cfg.j2
@@ -8,14 +8,6 @@
 	group haproxy
 	daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +24,17 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen uni
+    bind *:88
+	stats enable
+	stats uri /stats
+        server agama-1 EdvinToome-1:8002 check
+    server agama-4 EdvinToome-2:8002 check
+        server agama-2 EdvinToome-1:8003 check
+    server agama-5 EdvinToome-2:8003 check
+        server agama-3 EdvinToome-1:8004 check
+    server agama-6 EdvinToome-2:8004 check
+    
+
+

changed: [EdvinToome-1]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpj9r9o0ai/haproxy.cfg.j2
@@ -8,14 +8,6 @@
 	group haproxy
 	daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
 	log	global
@@ -32,3 +24,17 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen uni
+    bind *:88
+	stats enable
+	stats uri /stats
+        server agama-1 EdvinToome-1:8002 check
+    server agama-4 EdvinToome-2:8002 check
+        server agama-2 EdvinToome-1:8003 check
+    server agama-5 EdvinToome-2:8003 check
+        server agama-3 EdvinToome-1:8004 check
+    server agama-6 EdvinToome-2:8004 check
+    
+
+

changed: [EdvinToome-2]

TASK [haproxy : Start service haproxy, if not started] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Install HAProxy exporter] **************************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [haproxy : Start service prometheus-haproxy-exporter, if not started] *****
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Configure HAProxy exporter] ************************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp733ays80/haproxy.scrape-uri.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri='http://EdvinToome-1:88/stats;csv'"
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpof1zhuil/haproxy.scrape-uri.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri='http://EdvinToome-1:88/stats;csv'"
\ No newline at end of file

changed: [EdvinToome-2]

RUNNING HANDLER [mysql : Restart mysql] ****************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [EdvinToome-1] => (item=stopreplica) 
skipping: [EdvinToome-1] => (item=resetprimary) 
ok: [EdvinToome-2] => (item=stopreplica)
changed: [EdvinToome-2] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [EdvinToome-2] => (item=stopreplica) 
skipping: [EdvinToome-2] => (item=changeprimary) 
skipping: [EdvinToome-2] => (item=resetreplica) 
skipping: [EdvinToome-2] => (item=startreplica) 
ok: [EdvinToome-1] => (item=stopreplica)
changed: [EdvinToome-1] => (item=changeprimary)
changed: [EdvinToome-1] => (item=resetreplica)
changed: [EdvinToome-1] => (item=startreplica)

RUNNING HANDLER [mysql_exporter : restart mysql exporter] **********************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

RUNNING HANDLER [keepalived : Restart keepalived] ******************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

RUNNING HANDLER [keepalived : Restart keepalived-exporter] *********************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

RUNNING HANDLER [haproxy : Restart haproxy] ************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

RUNNING HANDLER [haproxy : Restart prometheus-haproxy-exporter] ****************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : add influxdb key] *********************************************
changed: [EdvinToome-3]

TASK [influxdb : add repository influxdb] **************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/repos_influxdata_com_debian.list
@@ -0,0 +1 @@
+deb https://repos.influxdata.com/debian stable main

changed: [EdvinToome-3]

TASK [influxdb : install influxdb] *********************************************
The following NEW packages will be installed:
  influxdb
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [influxdb : config influxdb] **********************************************
--- before: /etc/influxdb/influxdb.conf
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpxfyqll0j/influxdb.conf.j2
@@ -1,596 +1,39 @@
-### Welcome to the InfluxDB configuration file.
-
-# The values in this file override the default values used by the system if
-# a config option is not specified. The commented out lines are the configuration
-# field and the default value used. Uncommenting a line and changing the value
-# will change the value used at runtime when the process is restarted.
-
-# Once every 24 hours InfluxDB will report usage data to usage.influxdata.com
-# The data includes a random ID, os, arch, version, the number of series and other
-# usage data. No data from user databases is ever transmitted.
-# Change this option to true to disable reporting.
-# reporting-disabled = false
-
-# Bind address to use for the RPC service for backup and restore.
-# bind-address = "127.0.0.1:8088"
-
-###
-### [meta]
-###
-### Controls the parameters for the Raft consensus group that stores metadata
-### about the InfluxDB cluster.
-###
-
 [meta]
-  # Where the metadata/raft database is stored
   dir = "/var/lib/influxdb/meta"
 
-  # Automatically create a default retention policy when creating a database.
-  # retention-autocreate = true
-
-  # If log messages are printed for the meta service
-  # logging-enabled = true
-
-###
-### [data]
-###
-### Controls where the actual shard data for InfluxDB lives and how it is
-### flushed from the WAL. "dir" may need to be changed to a suitable place
-### for your system, but the WAL settings are an advanced configuration. The
-### defaults should work for most systems.
-###
-
 [data]
-  # The directory where the TSM storage engine stores TSM files.
   dir = "/var/lib/influxdb/data"
 
-  # The directory where the TSM storage engine stores WAL files.
   wal-dir = "/var/lib/influxdb/wal"
 
-  # The amount of time that a write will wait before fsyncing.  A duration
-  # greater than 0 can be used to batch up multiple fsync calls.  This is useful for slower
-  # disks or when WAL write contention is seen.  A value of 0s fsyncs every write to the WAL.
-  # Values in the range of 0-100ms are recommended for non-SSD disks.
-  # wal-fsync-delay = "0s"
-
-
-  # The type of shard index to use for new shards.  The default is an in-memory index that is
-  # recreated at startup.  A value of "tsi1" will use a disk based index that supports higher
-  # cardinality datasets.
-  # index-version = "inmem"
-
-  # Trace logging provides more verbose output around the tsm engine. Turning
-  # this on can provide more useful output for debugging tsm engine issues.
-  # trace-logging-enabled = false
-
-  # Whether queries should be logged before execution. Very useful for troubleshooting, but will
-  # log any sensitive data contained within a query.
-  # query-log-enabled = true
-
-  # Provides more error checking. For example, SELECT INTO will err out inserting an +/-Inf value
-  # rather than silently failing.
-  # strict-error-handling = false
-
-  # Validates incoming writes to ensure keys only have valid unicode characters.
-  # This setting will incur a small overhead because every key must be checked.
-  # validate-keys = false
-
-  # Settings for the TSM engine
-
-  # CacheMaxMemorySize is the maximum size a shard's cache can
-  # reach before it starts rejecting writes.
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # cache-max-memory-size = "1g"
-
-  # CacheSnapshotMemorySize is the size at which the engine will
-  # snapshot the cache and write it to a TSM file, freeing up memory
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # cache-snapshot-memory-size = "25m"
-
-  # CacheSnapshotWriteColdDuration is the length of time at
-  # which the engine will snapshot the cache and write it to
-  # a new TSM file if the shard hasn't received writes or deletes
-  # cache-snapshot-write-cold-duration = "10m"
-
-  # CompactFullWriteColdDuration is the duration at which the engine
-  # will compact all TSM files in a shard if it hasn't received a
-  # write or delete
-  # compact-full-write-cold-duration = "4h"
-
-  # The maximum number of concurrent full and level compactions that can run at one time.  A
-  # value of 0 results in 50% of runtime.GOMAXPROCS(0) used at runtime.  Any number greater
-  # than 0 limits compactions to that value.  This setting does not apply
-  # to cache snapshotting.
-  # max-concurrent-compactions = 0
-
-  # CompactThroughput is the rate limit in bytes per second that we
-  # will allow TSM compactions to write to disk. Note that short bursts are allowed
-  # to happen at a possibly larger value, set by CompactThroughputBurst
-  # compact-throughput = "48m"
-
-  # CompactThroughputBurst is the rate limit in bytes per second that we
-  # will allow TSM compactions to write to disk.
-  # compact-throughput-burst = "48m"
-
-  # If true, then the mmap advise value MADV_WILLNEED will be provided to the kernel with respect to
-  # TSM files. This setting has been found to be problematic on some kernels, and defaults to off.
-  # It might help users who have slow disks in some cases.
-  # tsm-use-madv-willneed = false
-
-  # Settings for the inmem index
-
-  # The maximum series allowed per database before writes are dropped.  This limit can prevent
-  # high cardinality issues at the database level.  This limit can be disabled by setting it to
-  # 0.
-  # max-series-per-database = 1000000
-
-  # The maximum number of tag values per tag that are allowed before writes are dropped.  This limit
-  # can prevent high cardinality tag values from being written to a measurement.  This limit can be
-  # disabled by setting it to 0.
-  # max-values-per-tag = 100000
-
-  # Settings for the tsi1 index
-
-  # The threshold, in bytes, when an index write-ahead log file will compact
-  # into an index file. Lower sizes will cause log files to be compacted more
-  # quickly and result in lower heap usage at the expense of write throughput.
-  # Higher sizes will be compacted less frequently, store more series in-memory,
-  # and provide higher write throughput.
-  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).
-  # Values without a size suffix are in bytes.
-  # max-index-log-file-size = "1m"
-
-  # The size of the internal cache used in the TSI index to store previously 
-  # calculated series results. Cached results will be returned quickly from the cache rather
-  # than needing to be recalculated when a subsequent query with a matching tag key/value 
-  # predicate is executed. Setting this value to 0 will disable the cache, which may
-  # lead to query performance issues.
-  # This value should only be increased if it is known that the set of regularly used 
-  # tag key/value predicates across all measurements for a database is larger than 100. An
-  # increase in cache size may lead to an increase in heap usage.
   series-id-set-cache-size = 100
 
-###
-### [coordinator]
-###
-### Controls the clustering service configuration.
-###
+  query-log-enabled = false
 
 [coordinator]
-  # The default time a write request will wait until a "timeout" error is returned to the caller.
-  # write-timeout = "10s"
-
-  # The maximum number of concurrent queries allowed to be executing at one time.  If a query is
-  # executed and exceeds this limit, an error is returned to the caller.  This limit can be disabled
-  # by setting it to 0.
-  # max-concurrent-queries = 0
-
-  # The maximum time a query will is allowed to execute before being killed by the system.  This limit
-  # can help prevent run away queries.  Setting the value to 0 disables the limit.
-  # query-timeout = "0s"
-
-  # The time threshold when a query will be logged as a slow query.  This limit can be set to help
-  # discover slow or resource intensive queries.  Setting the value to 0 disables the slow query logging.
-  # log-queries-after = "0s"
-
-  # The maximum number of points a SELECT can process.  A value of 0 will make
-  # the maximum point count unlimited.  This will only be checked every second so queries will not
-  # be aborted immediately when hitting the limit.
-  # max-select-point = 0
-
-  # The maximum number of series a SELECT can run.  A value of 0 will make the maximum series
-  # count unlimited.
-  # max-select-series = 0
-
-  # The maximum number of group by time bucket a SELECT can create.  A value of zero will max the maximum
-  # number of buckets unlimited.
-  # max-select-buckets = 0
-
-###
-### [retention]
-###
-### Controls the enforcement of retention policies for evicting old data.
-###
 
 [retention]
-  # Determines whether retention policy enforcement enabled.
-  # enabled = true
-
-  # The interval of time when retention policy enforcement checks run.
-  # check-interval = "30m"
-
-###
-### [shard-precreation]
-###
-### Controls the precreation of shards, so they are available before data arrives.
-### Only shards that, after creation, will have both a start- and end-time in the
-### future, will ever be created. Shards are never precreated that would be wholly
-### or partially in the past.
 
 [shard-precreation]
-  # Determines whether shard pre-creation service is enabled.
-  # enabled = true
-
-  # The interval of time when the check to pre-create new shards runs.
-  # check-interval = "10m"
-
-  # The default period ahead of the endtime of a shard group that its successor
-  # group is created.
-  # advance-period = "30m"
-
-###
-### Controls the system self-monitoring, statistics and diagnostics.
-###
-### The internal database for monitoring data is created automatically if
-### if it does not already exist. The target retention within this database
-### is called 'monitor' and is also created with a retention period of 7 days
-### and a replication factor of 1, if it does not exist. In all cases the
-### this retention policy is configured as the default for the database.
 
 [monitor]
-  # Whether to record statistics internally.
-  # store-enabled = true
-
-  # The destination database for recorded statistics
-  # store-database = "_internal"
-
-  # The interval at which to record statistics
-  # store-interval = "10s"
-
-###
-### [http]
-###
-### Controls how the HTTP endpoints are configured. These are the primary
-### mechanism for getting data into and out of InfluxDB.
-###
 
 [http]
-  # Determines whether HTTP endpoint is enabled.
-  # enabled = true
-
-  # Determines whether the Flux query endpoint is enabled.
-  # flux-enabled = false
-
-  # Determines whether the Flux query logging is enabled.
-  # flux-log-enabled = false
-
-  # The bind address used by the HTTP service.
-  # bind-address = ":8086"
-
-  # Determines whether user authentication is enabled over HTTP/HTTPS.
-  # auth-enabled = false
-
-  # The default realm sent back when issuing a basic auth challenge.
-  # realm = "InfluxDB"
-
-  # Determines whether HTTP request logging is enabled.
-  # log-enabled = true
-
-  # Determines whether the HTTP write request logs should be suppressed when the log is enabled.
-  # suppress-write-log = false
-
-  # When HTTP request logging is enabled, this option specifies the path where
-  # log entries should be written. If unspecified, the default is to write to stderr, which
-  # intermingles HTTP logs with internal InfluxDB logging.
-  #
-  # If influxd is unable to access the specified path, it will log an error and fall back to writing
-  # the request log to stderr.
-  # access-log-path = ""
-
-  # Filters which requests should be logged. Each filter is of the pattern NNN, NNX, or NXX where N is
-  # a number and X is a wildcard for any number. To filter all 5xx responses, use the string 5xx.
-  # If multiple filters are used, then only one has to match. The default is to have no filters which
-  # will cause every request to be printed.
-  # access-log-status-filters = []
-
-  # Determines whether detailed write logging is enabled.
-  # write-tracing = false
-
-  # Determines whether the pprof endpoint is enabled.  This endpoint is used for
-  # troubleshooting and monitoring.
-  # pprof-enabled = true
-
-  # Enables authentication on pprof endpoints. Users will need admin permissions
-  # to access the pprof endpoints when this setting is enabled. This setting has
-  # no effect if either auth-enabled or pprof-enabled are set to false.
-  # pprof-auth-enabled = false
-
-  # Enables a pprof endpoint that binds to localhost:6060 immediately on startup.
-  # This is only needed to debug startup issues.
-  # debug-pprof-enabled = false
-
-  # Enables authentication on the /ping, /metrics, and deprecated /status
-  # endpoints. This setting has no effect if auth-enabled is set to false.
-  # ping-auth-enabled = false
-
-  # Determines whether HTTPS is enabled.
-  # https-enabled = false
-
-  # The SSL certificate to use when HTTPS is enabled.
-  # https-certificate = "/etc/ssl/influxdb.pem"
-
-  # Use a separate private key location.
-  # https-private-key = ""
-
-  # The JWT auth shared secret to validate requests using JSON web tokens.
-  # shared-secret = ""
-
-  # The default chunk size for result sets that should be chunked.
-  # max-row-limit = 0
-
-  # The maximum number of HTTP connections that may be open at once.  New connections that
-  # would exceed this limit are dropped.  Setting this value to 0 disables the limit.
-  # max-connection-limit = 0
-
-  # Enable http service over unix domain socket
-  # unix-socket-enabled = false
-
-  # The path of the unix domain socket.
-  # bind-socket = "/var/run/influxdb.sock"
-
-  # The maximum size of a client request body, in bytes. Setting this value to 0 disables the limit.
-  # max-body-size = 25000000
-
-  # The maximum number of writes processed concurrently.
-  # Setting this to 0 disables the limit.
-  # max-concurrent-write-limit = 0
-
-  # The maximum number of writes queued for processing.
-  # Setting this to 0 disables the limit.
-  # max-enqueued-write-limit = 0
-
-  # The maximum duration for a write to wait in the queue to be processed.
-  # Setting this to 0 or setting max-concurrent-write-limit to 0 disables the limit.
-  # enqueued-write-timeout = 0
-
-	# User supplied HTTP response headers
-	#
-	# [http.headers]
-	#   X-Header-1 = "Header Value 1"
-	#   X-Header-2 = "Header Value 2"
-
-###
-### [logging]
-###
-### Controls how the logger emits logs to the output.
-###
+  log-enabled = false
+  write-tracing = false
 
 [logging]
-  # Determines which log encoder to use for logs. Available options
-  # are auto, logfmt, and json. auto will use a more a more user-friendly
-  # output format if the output terminal is a TTY, but the format is not as
-  # easily machine-readable. When the output is a non-TTY, auto will use
-  # logfmt.
-  # format = "auto"
-
-  # Determines which level of logs will be emitted. The available levels
-  # are error, warn, info, and debug. Logs that are equal to or above the
-  # specified level will be emitted.
-  # level = "info"
-
-  # Suppresses the logo output that is printed when the program is started.
-  # The logo is always suppressed if STDOUT is not a TTY.
-  # suppress-logo = false
-
-###
-### [subscriber]
-###
-### Controls the subscriptions, which can be used to fork a copy of all data
-### received by the InfluxDB host.
-###
 
 [subscriber]
-  # Determines whether the subscriber service is enabled.
-  # enabled = true
-
-  # The default timeout for HTTP writes to subscribers.
-  # http-timeout = "30s"
-
-  # Allows insecure HTTPS connections to subscribers.  This is useful when testing with self-
-  # signed certificates.
-  # insecure-skip-verify = false
-
-  # The path to the PEM encoded CA certs file. If the empty string, the default system certs will be used
-  # ca-certs = ""
-
-  # The number of writer goroutines processing the write channel.
-  # write-concurrency = 40
-
-  # The number of in-flight writes buffered in the write channel.
-  # write-buffer-size = 1000
-
-
-###
-### [[graphite]]
-###
-### Controls one or many listeners for Graphite data.
-###
 
 [[graphite]]
-  # Determines whether the graphite endpoint is enabled.
-  # enabled = false
-  # database = "graphite"
-  # retention-policy = ""
-  # bind-address = ":2003"
-  # protocol = "tcp"
-  # consistency-level = "one"
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # udp-read-buffer = 0
-
-  ### This string joins multiple matching 'measurement' values providing more control over the final measurement name.
-  # separator = "."
-
-  ### Default tags that will be added to all metrics.  These can be overridden at the template level
-  ### or by tags extracted from metric
-  # tags = ["region=us-east", "zone=1c"]
-
-  ### Each template line requires a template pattern.  It can have an optional
-  ### filter before the template and separated by spaces.  It can also have optional extra
-  ### tags following the template.  Multiple tags should be separated by commas and no spaces
-  ### similar to the line protocol format.  There can be only one default template.
-  # templates = [
-  #   "*.app env.service.resource.measurement",
-  #   # Default template
-  #   "server.*",
-  # ]
-
-###
-### [collectd]
-###
-### Controls one or many listeners for collectd data.
-###
 
 [[collectd]]
-  # enabled = false
-  # bind-address = ":25826"
-  # database = "collectd"
-  # retention-policy = ""
-  #
-  # The collectd service supports either scanning a directory for multiple types
-  # db files, or specifying a single db file.
-  # typesdb = "/usr/local/share/collectd"
-  #
-  # security-level = "none"
-  # auth-file = "/etc/collectd/auth_file"
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "10s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # read-buffer = 0
-
-  # Multi-value plugins can be handled two ways.
-  # "split" will parse and store the multi-value plugin data into separate measurements
-  # "join" will parse and store the multi-value plugin as a single multi-value measurement.
-  # "split" is the default behavior for backward compatibility with previous versions of influxdb.
-  # parse-multivalue-plugin = "split"
-###
-### [opentsdb]
-###
-### Controls one or many listeners for OpenTSDB data.
-###
 
 [[opentsdb]]
-  # enabled = false
-  # bind-address = ":4242"
-  # database = "opentsdb"
-  # retention-policy = ""
-  # consistency-level = "one"
-  # tls-enabled = false
-  # certificate= "/etc/ssl/influxdb.pem"
-
-  # Log an error for every malformed point.
-  # log-point-errors = true
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Only points
-  # metrics received over the telnet protocol undergo batching.
-
-  # Flush if this many points get buffered
-  # batch-size = 1000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 5
-
-  # Flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-###
-### [[udp]]
-###
-### Controls the listeners for InfluxDB line protocol data via UDP.
-###
 
 [[udp]]
-  # enabled = false
-  # bind-address = ":8089"
-  # database = "udp"
-  # retention-policy = ""
-
-  # InfluxDB precision for timestamps on received points ("" or "n", "u", "ms", "s", "m", "h")
-  # precision = ""
-
-  # These next lines control how batching works. You should have this enabled
-  # otherwise you could get dropped metrics or poor performance. Batching
-  # will buffer points in memory if you have many coming in.
-
-  # Flush if this many points get buffered
-  # batch-size = 5000
-
-  # Number of batches that may be pending in memory
-  # batch-pending = 10
-
-  # Will flush at least this often even if we haven't hit buffer limit
-  # batch-timeout = "1s"
-
-  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.
-  # read-buffer = 0
-
-###
-### [continuous_queries]
-###
-### Controls how continuous queries are run within InfluxDB.
-###
 
 [continuous_queries]
-  # Determines whether the continuous query service is enabled.
-  # enabled = true
 
-  # Controls whether queries are logged when executed by the CQ service.
-  # log-enabled = true
-
-  # Controls whether queries are logged to the self-monitoring data store.
-  # query-stats-enabled = false
-
-  # interval for how often continuous queries will be checked if they need to run
-  # run-interval = "1s"
-
-###
-### [tls]
-###
-### Global configuration settings for TLS in InfluxDB.
-###
-
-[tls]
-  # Determines the available set of cipher suites. See https://golang.org/pkg/crypto/tls/#pkg-constants
-  # for a list of available ciphers, which depends on the version of Go (use the query
-  # SHOW DIAGNOSTICS to see the version of Go used to build InfluxDB). If not specified, uses
-  # the default settings from Go's crypto/tls package.
-  # ciphers = [
-  #   "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305",
-  #   "TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305",
-  # ]
-
-  # Minimum version of the tls protocol that will be negotiated. If not specified, uses the
-  # default settings from Go's crypto/tls package.
-  # min-version = "tls1.2"
-
-  # Maximum version of the tls protocol that will be negotiated. If not specified, uses the
-  # default settings from Go's crypto/tls package.
-  # max-version = "tls1.3"
+[tls]
\ No newline at end of file

changed: [EdvinToome-3]

TASK [influxdb : install fping] ************************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [influxdb : Enable influxdb] **********************************************
changed: [EdvinToome-3]

TASK [influxdb : Add the user 'pinger'] ****************************************
changed: [EdvinToome-3]

TASK [influxdb : config pinger.service] ****************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpu4bbg198/pinger.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Somedescription
+Documentation=https://github.com/romankuchin/ica0002-2022/blob/main/08-logging/README.md
+After=network-online.target
+
+[Service]
+User=pinger
+ExecStart=/usr/local/bin/pinger/pinger.sh
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [EdvinToome-3]

TASK [influxdb : Create a directory /usr/local/bin/pinger/] ********************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "mode": "0755",
-    "owner": 0,
+    "mode": "0777",
+    "owner": 1003,
     "path": "/usr/local/bin/pinger/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [influxdb : config pinger.sh] *********************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpn5lvl97h/pinger.sh.j2
@@ -0,0 +1,28 @@
+#!/bin/bash
+
+# Script contains several (more than 1) security issues.
+# Find them and fix them to get bonus on exam.
+# Problem example: SQL injection.
+
+for t in database_url database_name targets; do
+  if ! grep -q "^${t}=" /etc/pinger/pinger.conf; then
+    logger "$0 Failed to get $t from config"
+    exit 1
+  fi
+done
+
+which fping > /dev/null || (logger "fping not found"; exit 1)
+
+db_url=$(grep "^database_url=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/pinger/pinger.conf | sed 's/^.*=//')
+targets=$(grep "^targets=" /etc/pinger/pinger.conf | sed 's/^.*=//' | sed 's/\(,\|;\)/ /g')
+
+curl -i -XPOST "${db_url}/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null
+
+while true; do
+#  result=$(fping $targets -q -C1 2>&1 | awk '{print "rtt,dst="$1" rtt="$3}')
+#  curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "$result" 1>/dev/null 2>/dev/null
+#  curl -i -XPOST '${db_url}/write?db=$db_name' --data-binary "$(fping $targets -q -C1 2>&1 | awk '{print "$db_name,dst="$1" rtt="$3}')" 1>/dev/null 2>/dev/null
+  curl -i -XPOST 'EdvinToome-3:8086/write?db=latency' --data-binary "$(fping google.com cloudflare.com twitter.com -q -C1 2>&1 | awk '{print "latency,dst="$1" rtt="$3}')" 1>/dev/null 2>/dev/null
+ sleep 1
+done

changed: [EdvinToome-3]

TASK [influxdb : Create a directory /etc/pinger/] ******************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "mode": "0755",
-    "owner": 0,
+    "mode": "0777",
+    "owner": 1003,
     "path": "/etc/pinger/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [influxdb : config pinger.conf] *******************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp6tx1jsoq/pinger.conf.j2
@@ -0,0 +1,3 @@
+database_url=EdvinToome-3:8086
+database_name=latency
+targets=google.com cloudflare.com twitter.com
\ No newline at end of file

changed: [EdvinToome-3]

TASK [influxdb : Enable pinger] ************************************************
changed: [EdvinToome-3]

TASK [influxdb : install telegraf] *********************************************
The following NEW packages will be installed:
  telegraf
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [influxdb : config telegraf] **********************************************
diff skipped: destination file size is greater than 104448
changed: [EdvinToome-3]

TASK [influxdb : config rsyslog] ***********************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpi2i_1e47/50-telegraf2.conf.j2
@@ -0,0 +1,9 @@
+#$WorkDirectory /var/spool/rsyslog  
+#$ActionQueueType LinkedList  
+#$ActionQueueFileName srvrfwd  
+#$ActionResumeRetryCount -1  
+$ActionQueueSaveOnShutdown on  
+$ModLoad imudp #loads the udp module  
+$UDPServerAddress localhost 
+$UDPServerRun 514 
+*.* @@(o)EdvinToome-3:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [EdvinToome-3]

TASK [influxdb : Enable telegraf] **********************************************
changed: [EdvinToome-3]

TASK [influxdb_exporter : check if influxdb_exporter exist] ********************
ok: [EdvinToome-3]

TASK [influxdb_exporter : Download influxdb exporter] **************************
changed: [EdvinToome-3]

TASK [influxdb_exporter : install service] *************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp_16anpai/prometheus-influxdb-stats-exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=InfluxDB exporter
+After=network-online.target
+[Service]
+User=prometheus
+Group=prometheus
+Type=simple
+ExecStart=/usr/local/bin/influxdb_exporter
+[Install]
+WantedBy=multi-user.target
+

changed: [EdvinToome-3]

TASK [influxdb_exporter : Enable influxdb_exporter] ****************************
changed: [EdvinToome-3]

TASK [influxdb_backup : Create a directory /home/backup/influxdb] **************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
--- before: crontab for user "backup"
+++ after: crontab for user "backup"
@@ -0,0 +1,2 @@
+#Ansible: InfluxDB dump
+0 0 * * 0 influxd backup -portable /home/backup/influxdb

changed: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
--- before: crontab for user "backup"
+++ after: crontab for user "backup"
@@ -1,2 +1,4 @@
 #Ansible: InfluxDB dump
 0 0 * * 0 influxd backup -portable /home/backup/influxdb
+#Ansible: Influxdb dump
+0 1 * * 0 duplicity --no-encryption incremental /home/backup/influxdb rsync://EdvinToome@backup.larsenbiscuits.io/influxdb

changed: [EdvinToome-3]

RUNNING HANDLER [influxdb : Restart pinger] ************************************
changed: [EdvinToome-3]

RUNNING HANDLER [influxdb : Restart telegraf] **********************************
changed: [EdvinToome-3]

RUNNING HANDLER [influxdb : Restart influxdb] **********************************
changed: [EdvinToome-3]

RUNNING HANDLER [influxdb : Restart rsyslog] ***********************************
changed: [EdvinToome-3]

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common
Suggested packages:
  libgd-tools geoip-bin fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-full
0 upgraded, 25 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common
Suggested packages:
  libgd-tools geoip-bin fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core geoip-database libfontconfig1 libgd3
  libgeoip1 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-auth-pam
  libnginx-mod-http-dav-ext libnginx-mod-http-echo libnginx-mod-http-geoip
  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter
  libnginx-mod-http-subs-filter libnginx-mod-http-upstream-fair
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-full
0 upgraded, 25 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : NGINX config] ****************************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpgo0z4dgj/default.j2
@@ -1,91 +1,17 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
+	listen 80;
 	server_name _;
 
 	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+		proxy_pass            http://localhost:8002;
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
+    listen 8080 default_server;
 
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
+	location = /stub_status {
+	    stub_status;
+	}
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    
+	}
\ No newline at end of file

changed: [EdvinToome-2]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpolxtnfm4/default.j2
@@ -1,91 +1,17 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
+	listen 80;
 	server_name _;
 
 	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+		proxy_pass            http://localhost:8002;
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
+    listen 8080 default_server;
 
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
+	location = /stub_status {
+	    stub_status;
+	}
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    
+	}
\ No newline at end of file

changed: [EdvinToome-1]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : update and install nginx exporter] **********************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp7igqdwdn/prometheus-nginx-exporter.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address=':9113'"
\ No newline at end of file

changed: [EdvinToome-1]
--- before: /etc/default/prometheus-nginx-exporter
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp7wmv5aqa/prometheus-nginx-exporter.j2
@@ -1,14 +1 @@
-ARGS=""
-
-# Prometheus-nginx-exporter supports the following options:
-#  -nginx.plus
-#        Start the exporter for NGINX Plus. By default, the exporter is started
-#        for NGINX.
-#  -nginx.scrape-uri string
-#        A URI for scraping NGINX or NGINX Plus metrics.
-#        For NGINX, the stub_status page must be available through the URI.
-#        For NGINX Plus -- the API. (default "http://127.0.0.1:8080/stub_status")
-#  -web.listen-address string
-#        An address to listen on for web interface and telemetry. (default ":9113")
-#  -web.telemetry-path string
-#        A path under which to expose metrics. (default "/metrics"
+ARGS="-web.listen-address=':9113'"
\ No newline at end of file

changed: [EdvinToome-2]

TASK [nginx_exporter : Enable nginx exporter] **********************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

RUNNING HANDLER [nginx : Restart nginx] ****************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

RUNNING HANDLER [nginx_exporter : Restart nginx exporter] **********************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

PLAY [Agama] *******************************************************************

TASK [docker : Install docker] *************************************************
The following additional packages will be installed:
  containerd dnsmasq-base libidn11 pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]
The following additional packages will be installed:
  containerd dnsmasq-base libidn11 pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]

TASK [agama : Install agama dependency] ****************************************
The following additional packages will be installed:
  javascript-common libjs-jquery python3-flask python3-itsdangerous
  python3-pyinotify python3-sqlalchemy python3-sqlalchemy-ext python3-werkzeug
Suggested packages:
  python-flask-doc python-pyinotify-doc python-sqlalchemy-doc python3-psycopg2
  python3-mysqldb python3-fdb ipython3 python-werkzeug-doc python3-lxml
  python3-termcolor python3-watchdog
The following NEW packages will be installed:
  javascript-common libjs-jquery python3-flask python3-flask-sqlalchemy
  python3-itsdangerous python3-pyinotify python3-sqlalchemy
  python3-sqlalchemy-ext python3-werkzeug
0 upgraded, 9 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-1]
The following additional packages will be installed:
  javascript-common libjs-jquery python3-flask python3-itsdangerous
  python3-pyinotify python3-sqlalchemy python3-sqlalchemy-ext python3-werkzeug
Suggested packages:
  python-flask-doc python-pyinotify-doc python-sqlalchemy-doc python3-psycopg2
  python3-mysqldb python3-fdb ipython3 python-werkzeug-doc python3-lxml
  python3-termcolor python3-watchdog
The following NEW packages will be installed:
  javascript-common libjs-jquery python3-flask python3-flask-sqlalchemy
  python3-itsdangerous python3-pyinotify python3-sqlalchemy
  python3-sqlalchemy-ext python3-werkzeug
0 upgraded, 9 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-2]

TASK [agama : Add the user 'agama'] ********************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [agama : Create a directory /opt/agama] ***********************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "mode": "0755",
+    "mode": "0777",
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "mode": "0755",
+    "mode": "0777",
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-2]

TASK [agama : Download agama] **************************************************
changed: [EdvinToome-2]
changed: [EdvinToome-1]

TASK [agama : Download agama docker] *******************************************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [agama : Build an image and push it to a private repo] ********************
changed: [EdvinToome-1]
changed: [EdvinToome-2]

TASK [agama : Run agama container] *********************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-1] => (item=1)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-2] => (item=1)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-1] => (item=2)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-2] => (item=2)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-1] => (item=3)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-2] => (item=3)

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker] *************************************************
The following additional packages will be installed:
  containerd dnsmasq-base libidn11 pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 10 newly installed, 0 to remove and 229 not upgraded.
changed: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/dashboards] *******
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/datasources] ******
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [grafana : Config grafana] ************************************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmp5a00lfjx/grafana.ini.j2
@@ -0,0 +1,3 @@
+[server]
+root_url = http://193.40.156.67:41980/grafana/
+serve_from_sub_path = true

changed: [EdvinToome-3]

TASK [grafana : Provisioning Grafana datasource] *******************************
--- before
+++ after: /home/edvin/.ansible/tmp/ansible-local-295993xql03cwk/tmpwen1rm0n/datasource.yaml.j2
@@ -0,0 +1,34 @@
+apiVersion: 1
+
+datasources:
+  - name: prometheus
+    type: prometheus
+    access: proxy
+    orgId: 1
+    uid: "prometheus"
+    url: "http://EdvinToome-3:9090/prometheus"
+    isDefault: true
+    version: 1
+    editable: true
+
+  - name: influxdb-pinger
+    type: influxdb
+    access: proxy
+    orgId: 1
+    uid: "influxdb-pinger"
+    url: "http://EdvinToome-3:8086"
+    database: latency
+    httpMethod: 'POST'
+    version: 1
+    editable: true
+
+  - name: influxdb-telegraf
+    type: influxdb
+    access: proxy
+    orgId: 1
+    uid: "influxdb-telegraf"
+    url: "http://EdvinToome-3:8086"
+    database: telegraf
+    httpMethod: 'POST'
+    version: 1
+    editable: true
\ No newline at end of file

changed: [EdvinToome-3]

TASK [grafana : Run Grafana container] *****************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [EdvinToome-3]

TASK [grafana : Create a directory /var/lib/grafana/dashboards] ****************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/var/lib/grafana/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [EdvinToome-3]

TASK [grafana : Import dashboard] **********************************************
--- before
+++ after: /home/edvin/Documents/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1290 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "target": {
+          "limit": 100,
+          "matchAny": false,
+          "tags": [],
+          "type": "dashboard"
+        },
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 3,
+  "links": [],
+  "liveNow": false,
+  "panels": [
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "influxdb-pinger"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 22,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "influxdb-pinger"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "dst"
+              ],
+              "type": "tag"
+            }
+          ],
+          "measurement": "latency",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "rtt"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": []
+        }
+      ],
+      "title": "Latency",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 4,
+        "x": 12,
+        "y": 0
+      },
+      "id": 25,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "rate(influxdb_write_write_ok[1m])",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB write rate",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 20,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "keepalived_vrrp_state",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Keepalived VRRP state",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 5,
+        "x": 0,
+        "y": 16
+      },
+      "id": 14,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "rate(nginx_http_requests_total[5m])",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "NGINX requests",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 5,
+        "x": 5,
+        "y": 16
+      },
+      "id": 12,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL queries",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 5,
+        "x": 10,
+        "y": 16
+      },
+      "id": 10,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "rate(bind_resolver_queries_total[5m])",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "DNS Queries",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 4,
+        "x": 0,
+        "y": 23
+      },
+      "id": 6,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "bind_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 4,
+        "x": 4,
+        "y": 23
+      },
+      "id": 8,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "nginx_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "NGINX",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 7,
+        "x": 8,
+        "y": 23
+      },
+      "id": 18,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "haproxy_server_up",
+          "legendFormat": "",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "HAPROXY",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 2,
+        "x": 4,
+        "y": 28
+      },
+      "id": 7,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "mysql_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 2,
+        "x": 6,
+        "y": 28
+      },
+      "id": 16,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "haproxy_up",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "HAPROXY",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "index": 1,
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "index": 0,
+                  "text": "UP"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 2,
+        "x": 8,
+        "y": 28
+      },
+      "id": 23,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "textMode": "auto"
+      },
+      "pluginVersion": "9.3.2",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "influxdb_exporter_stats_query_success",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB health ",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 2,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green"
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 32
+      },
+      "id": 4,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "code",
+          "expr": "node_memory_MemFree_bytes/node_memory_MemTotal_bytes*100",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Memory usage",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "lineInterpolation": "linear",
+            "lineWidth": 2,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green"
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 0,
+        "y": 40
+      },
+      "id": 2,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "prometheus"
+          },
+          "editorMode": "builder",
+          "expr": "1-rate(node_cpu_seconds_total{mode=\"idle\"}[1m])",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "CPU Load",
+      "type": "timeseries"
+    }
+  ],
+  "schemaVersion": 37,
+  "style": "dark",
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Main",
+  "uid": "-ZE3JA54z",
+  "version": 3,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [EdvinToome-3] => (item=main.json)
--- before
+++ after: /home/edvin/Documents/ica0002/roles/grafana/files/rsyslog.json
@@ -0,0 +1,1029 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "datasource",
+            "uid": "grafana"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "target": {
+            "limit": 100,
+            "matchAny": false,
+            "tags": [],
+            "type": "dashboard"
+          },
+          "type": "dashboard"
+        }
+      ]
+    },
+    "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "gnetId": 12433,
+    "graphTooltip": 0,
+    "id": 2,
+    "links": [],
+    "liveNow": false,
+    "panels": [
+      {
+        "aliasColors": {},
+        "bars": true,
+        "dashLength": 10,
+        "dashes": false,
+        "datasource": {
+          "type": "influxdb",
+          "uid": "influxdb-telegraf"
+        },
+        "decimals": 0,
+        "fill": 1,
+        "fillGradient": 0,
+        "gridPos": {
+          "h": 7,
+          "w": 24,
+          "x": 0,
+          "y": 0
+        },
+        "hiddenSeries": false,
+        "id": 10,
+        "interval": "",
+        "legend": {
+          "alignAsTable": true,
+          "avg": true,
+          "current": false,
+          "max": true,
+          "min": false,
+          "rightSide": true,
+          "show": true,
+          "total": true,
+          "values": true
+        },
+        "lines": false,
+        "linewidth": 1,
+        "links": [],
+        "nullPointMode": "connected",
+        "options": {
+          "alertThreshold": true
+        },
+        "percentage": false,
+        "pluginVersion": "9.3.2",
+        "pointradius": 2,
+        "points": false,
+        "renderer": "flot",
+        "seriesOverrides": [
+          {
+            "alias": "Info",
+            "color": "rgb(80, 80, 80)",
+            "stack": "A"
+          },
+          {
+            "alias": "Notice",
+            "color": "rgb(182, 182, 182)",
+            "stack": "A"
+          },
+          {
+            "alias": "Warning",
+            "color": "#E0B400",
+            "stack": "A"
+          },
+          {
+            "alias": "Error",
+            "color": "#FF780A",
+            "stack": "A"
+          },
+          {
+            "alias": "Critical",
+            "color": "#E02F44",
+            "stack": "A"
+          },
+          {
+            "alias": "Alert",
+            "color": "#8F3BB8",
+            "stack": "A"
+          },
+          {
+            "alias": "Emergency",
+            "color": "#8F3BB8",
+            "stack": "A"
+          }
+        ],
+        "spaceLength": 10,
+        "stack": false,
+        "steppedLine": false,
+        "targets": [
+          {
+            "alias": "Info",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "A",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "info"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Notice",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "B",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "notice"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Warning",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "D",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "warning"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Error",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "C",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "err"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Critical",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "E",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "crit"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Alert",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "F",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "alert"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Emergency",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "G",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "emerg"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          }
+        ],
+        "thresholds": [],
+        "timeRegions": [],
+        "title": "syslog count",
+        "tooltip": {
+          "shared": true,
+          "sort": 0,
+          "value_type": "individual"
+        },
+        "type": "graph",
+        "xaxis": {
+          "mode": "time",
+          "show": true,
+          "values": []
+        },
+        "yaxes": [
+          {
+            "decimals": 0,
+            "format": "none",
+            "label": "Messages / min",
+            "logBase": 1,
+            "show": true
+          },
+          {
+            "format": "short",
+            "logBase": 1,
+            "show": false
+          }
+        ],
+        "yaxis": {
+          "align": false
+        }
+      },
+      {
+        "datasource": {
+          "type": "influxdb",
+          "uid": "influxdb-telegraf"
+        },
+        "description": "",
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "custom": {
+              "align": "left",
+              "displayMode": "auto",
+              "filterable": false,
+              "inspect": false
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "dark-purple",
+                  "value": null
+                },
+                {
+                  "color": "dark-red",
+                  "value": 2
+                },
+                {
+                  "color": "dark-orange",
+                  "value": 3
+                },
+                {
+                  "color": "dark-yellow",
+                  "value": 4
+                },
+                {
+                  "color": "rgb(150, 150, 150)",
+                  "value": 5
+                },
+                {
+                  "color": "rgb(51, 51, 51)",
+                  "value": 6
+                },
+                {
+                  "color": "rgb(5, 5, 5)",
+                  "value": 7
+                }
+              ]
+            }
+          },
+          "overrides": [
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "severity_code"
+              },
+              "properties": [
+                {
+                  "id": "mappings",
+                  "value": [
+                    {
+                      "options": {
+                        "0": {
+                          "text": "Emergency"
+                        },
+                        "1": {
+                          "text": "Alert"
+                        },
+                        "2": {
+                          "text": "Critical"
+                        },
+                        "3": {
+                          "text": "Error"
+                        },
+                        "4": {
+                          "text": "Warning"
+                        },
+                        "5": {
+                          "text": "Notice"
+                        },
+                        "6": {
+                          "text": "Info"
+                        },
+                        "7": {
+                          "text": "Debug"
+                        }
+                      },
+                      "type": "value"
+                    }
+                  ]
+                },
+                {
+                  "id": "custom.displayMode",
+                  "value": "color-background"
+                },
+                {
+                  "id": "custom.width",
+                  "value": 119
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "Time"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 163
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "hostname"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 194
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "appname"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 264
+                }
+              ]
+            }
+          ]
+        },
+        "gridPos": {
+          "h": 24,
+          "w": 24,
+          "x": 0,
+          "y": 7
+        },
+        "id": 12,
+        "options": {
+          "footer": {
+            "fields": "",
+            "reducer": [
+              "sum"
+            ],
+            "show": false
+          },
+          "showHeader": true,
+          "sortBy": [
+            {
+              "desc": true,
+              "displayName": "Time"
+            }
+          ]
+        },
+        "pluginVersion": "9.3.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "influxdb",
+              "uid": "influxdb-telegraf"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "hostname"
+                ],
+                "type": "tag"
+              },
+              {
+                "params": [
+                  "appname"
+                ],
+                "type": "tag"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "A",
+            "resultFormat": "table",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                }
+              ],
+              [
+                {
+                  "params": [
+                    "message"
+                  ],
+                  "type": "field"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          }
+        ],
+        "title": "Syslog Messages",
+        "type": "table"
+      }
+    ],
+    "refresh": "5s",
+    "schemaVersion": 37,
+    "style": "dark",
+    "tags": [],
+    "templating": {
+      "list": [
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "influxdb-telegraf"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Appname",
+          "multi": true,
+          "name": "appname",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 1,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "influxdb-telegraf"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Hostname",
+          "multi": true,
+          "name": "hostname",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 1,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "influxdb-telegraf"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Severity",
+          "multi": true,
+          "name": "severity",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 0,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "current": {
+            "selected": false,
+            "text": "",
+            "value": ""
+          },
+          "description": "Querystring",
+          "hide": 0,
+          "label": "MessageQuery",
+          "name": "Query",
+          "options": [
+            {
+              "selected": true,
+              "text": "",
+              "value": ""
+            }
+          ],
+          "query": "",
+          "skipUrlSync": false,
+          "type": "textbox"
+        }
+      ]
+    },
+    "time": {
+      "from": "now-1h",
+      "to": "now"
+    },
+    "timepicker": {
+      "refresh_intervals": [
+        "5s",
+        " 10s",
+        " 30s",
+        " 1m",
+        " 5m"
+      ],
+      "time_options": [
+        "5m",
+        "15m",
+        "1h",
+        "6h",
+        "12h",
+        "24h",
+        "2d",
+        "7d",
+        "30d"
+      ]
+    },
+    "timezone": "",
+    "title": "Syslog",
+    "uid": "TIYeHqRgZ",
+    "version": 2,
+    "weekStart": ""
+  }
\ No newline at end of file

changed: [EdvinToome-3] => (item=rsyslog.json)
--- before
+++ after: /home/edvin/Documents/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,587 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "grafana",
+            "uid": "-- Grafana --"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "target": {
+            "limit": 100,
+            "matchAny": false,
+            "tags": [],
+            "type": "dashboard"
+          },
+          "type": "dashboard"
+        }
+      ]
+    },
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "graphTooltip": 0,
+    "id": 5,
+    "links": [],
+    "liveNow": false,
+    "panels": [
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 7,
+          "w": 8,
+          "x": 0,
+          "y": 0
+        },
+        "id": 12,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "code",
+            "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL queries",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "blue",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 6,
+          "w": 3,
+          "x": 8,
+          "y": 0
+        },
+        "id": 2,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "textMode": "auto"
+        },
+        "pluginVersion": "9.3.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "builder",
+            "expr": "mysql_global_variables_server_id",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL server ID",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "DOWN"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "UP"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 6,
+          "w": 5,
+          "x": 0,
+          "y": 7
+        },
+        "id": 10,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "textMode": "auto"
+        },
+        "pluginVersion": "9.3.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "builder",
+            "expr": "mysql_up",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 8,
+          "x": 0,
+          "y": 13
+        },
+        "id": 8,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "builder",
+            "expr": "mysql_slave_status_slave_sql_running",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL replication thread",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": [
+            {
+              "__systemRef": "hideSeriesFrom",
+              "matcher": {
+                "id": "byNames",
+                "options": {
+                  "mode": "exclude",
+                  "names": [
+                    "{__name__=\"mysql_slave_status_slave_io_running\", instance=\"EdvinToome-1:9104\", job=\"mysql\", master_host=\"EdvinToome-2\", master_uuid=\"6f63577b-7f94-11ed-99b8-fa163ea94200\"}"
+                  ],
+                  "prefix": "All except:",
+                  "readOnly": true
+                }
+              },
+              "properties": [
+                {
+                  "id": "custom.hideFrom",
+                  "value": {
+                    "legend": false,
+                    "tooltip": false,
+                    "viz": true
+                  }
+                }
+              ]
+            }
+          ]
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 8,
+          "x": 0,
+          "y": 21
+        },
+        "id": 6,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "builder",
+            "expr": "mysql_slave_status_slave_io_running",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL replication thread",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "prometheus"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 6,
+          "w": 4,
+          "x": 0,
+          "y": 29
+        },
+        "id": 4,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "prometheus"
+            },
+            "editorMode": "builder",
+            "expr": "mysql_global_variables_read_only",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": " MySQL server read only status",
+        "type": "timeseries"
+      }
+    ],
+    "schemaVersion": 37,
+    "style": "dark",
+    "tags": [],
+    "templating": {
+      "list": []
+    },
+    "time": {
+      "from": "now-6h",
+      "to": "now"
+    },
+    "timepicker": {},
+    "timezone": "",
+    "title": "MySQL",
+    "uid": "wyNekU5Vz",
+    "version": 4,
+    "weekStart": ""
+  }
\ No newline at end of file

changed: [EdvinToome-3] => (item=mysql.json)

TASK [grafana : Wait for Grafana to start] *************************************
ok: [EdvinToome-3]

TASK [grafana : Provision dashboard] *******************************************
changed: [EdvinToome-3] => (item=main.json)
changed: [EdvinToome-3] => (item=rsyslog.json)
changed: [EdvinToome-3] => (item=mysql.json)

RUNNING HANDLER [grafana : restart grafana] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [EdvinToome-3]

PLAY RECAP *********************************************************************
EdvinToome-1               : ok=84   changed=72   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
EdvinToome-2               : ok=88   changed=75   unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
EdvinToome-3               : ok=87   changed=74   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   


PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [init : Update APT cache] *************************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [rsyslog : Configure rsyslog] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [backup : Add the user 'backup'] ******************************************
ok: [EdvinToome-2]
ok: [EdvinToome-3]
ok: [EdvinToome-1]

TASK [backup : Create a 2048-bit SSH key] **************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [backup : Copy known hosts] ***********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [backup : Create a directory /home/backup/restore] ************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [backup : install duplicity] **********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [node_exporter : Install node_exporter] ***********************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [node_exporter : prometheus-node-exporter config] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [node_exporter : Enable node exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [users : Add the user 'juri'] *********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [users : Add the user 'roman'] ********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [users : juri] ************************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [users : roman] ***********************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind9] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Start service bind9, if not started] ******************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Configure access rules for DNS server] ****************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Configure conf local] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Configure resolv.conf] ********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-3]
ok: [EdvinToome-1]

TASK [bind : Configure DB.larsenbiscuits.io] ***********************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Configure DB rev] *************************************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Force flushers] ***************************************************

TASK [bind_exporter : update and install bind exporter] ************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [bind_exporter : install service] *****************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

PLAY [DNS master] **************************************************************

TASK [dns_records : Set CNAME records] *****************************************
ok: [EdvinToome-3] => (item={'key': 'grafana', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'influxdb', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'lb1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'lb2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'mysql1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'mysql2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'ns1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'ns2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'prometheus', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'web1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'web2', 'value': 'EdvinToome-2'})

TASK [dns_records : Set A records] *********************************************
ok: [EdvinToome-3] => (item={'key': 'backup', 'value': '192.168.42.132'})

PLAY [Prometheus] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [EdvinToome-3]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-3]

TASK [nginx : NGINX config] ****************************************************
ok: [EdvinToome-3]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-3]

TASK [prometheus : update and install prometheus] ******************************
ok: [EdvinToome-3]

TASK [prometheus : prometheus args] ********************************************
ok: [EdvinToome-3]

TASK [prometheus : prometheus configuration file] ******************************
ok: [EdvinToome-3]

TASK [prometheus : start prometheus] *******************************************
ok: [EdvinToome-3]

TASK [prometheus : Install nginx] **********************************************
ok: [EdvinToome-3]

TASK [prometheus : Start service nginx, if not started] ************************
ok: [EdvinToome-3]

TASK [prometheus : Enable service nginx, and not touch the state] **************
ok: [EdvinToome-3]

TASK [nginx_exporter : update and install nginx exporter] **********************
ok: [EdvinToome-3]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
ok: [EdvinToome-3]

TASK [nginx_exporter : Enable nginx exporter] **********************************
ok: [EdvinToome-3]

PLAY [Database server] *********************************************************

TASK [mysql : Install python3-pymysql] *****************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Install mysql-server] ********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Start service mysql, if not started] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Enable service mysql, and not touch the state] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : mysql config] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL database] **************************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql : MySQL user] ******************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL user replication] ******************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL read only for replica server] ******************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : update and install mysql node exporter] *****************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : create mysql user] **************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : Enable mysql exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : config mysql] *******************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : config prometheus-mysqld-exporter] **********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : Create a directory /home/backup/mysql] ********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : create mysql user backup] *********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : config mysql] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Install keepalived] *****************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Keepalived config] ******************************************
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Start service keepalived, if not started] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Add keepalived_script user] *********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Add keepalive script] ***************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Enable service keepalived, and not touch the state] *********
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Create a directory /usr/local/bin/keepalived-exporter/] *****
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : download and unzip node exporter if not exist] **************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : config keepalived exporter.service] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Start keepalived exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Install haproxy] ***********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Configure haproxy] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Start service haproxy, if not started] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Install HAProxy exporter] **************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Start service prometheus-haproxy-exporter, if not started] *****
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Configure HAProxy exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : add influxdb key] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : add repository influxdb] **************************************
ok: [EdvinToome-3]

TASK [influxdb : install influxdb] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : config influxdb] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : install fping] ************************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable influxdb] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : Add the user 'pinger'] ****************************************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.service] ****************************************
ok: [EdvinToome-3]

TASK [influxdb : Create a directory /usr/local/bin/pinger/] ********************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.sh] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : Create a directory /etc/pinger/] ******************************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.conf] *******************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable pinger] ************************************************
ok: [EdvinToome-3]

TASK [influxdb : install telegraf] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : config telegraf] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : config rsyslog] ***********************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable telegraf] **********************************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : check if influxdb_exporter exist] ********************
ok: [EdvinToome-3]

TASK [influxdb_exporter : Download influxdb exporter] **************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : install service] *************************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : Enable influxdb_exporter] ****************************
ok: [EdvinToome-3]

TASK [influxdb_backup : Create a directory /home/backup/influxdb] **************
ok: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
ok: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
ok: [EdvinToome-3]

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : NGINX config] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [nginx_exporter : update and install nginx exporter] **********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : Enable nginx exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

PLAY [Agama] *******************************************************************

TASK [docker : Install docker] *************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Install agama dependency] ****************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [agama : Add the user 'agama'] ********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Create a directory /opt/agama] ***********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Download agama] **************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Download agama docker] *******************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Build an image and push it to a private repo] ********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Run agama container] *********************************************
ok: [EdvinToome-1] => (item=1)
ok: [EdvinToome-2] => (item=1)
ok: [EdvinToome-1] => (item=2)
ok: [EdvinToome-2] => (item=2)
ok: [EdvinToome-1] => (item=3)
ok: [EdvinToome-2] => (item=3)

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker] *************************************************
ok: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/dashboards] *******
ok: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/datasources] ******
ok: [EdvinToome-3]

TASK [grafana : Config grafana] ************************************************
ok: [EdvinToome-3]

TASK [grafana : Provisioning Grafana datasource] *******************************
ok: [EdvinToome-3]

TASK [grafana : Run Grafana container] *****************************************
ok: [EdvinToome-3]

TASK [grafana : Create a directory /var/lib/grafana/dashboards] ****************
ok: [EdvinToome-3]

TASK [grafana : Import dashboard] **********************************************
ok: [EdvinToome-3] => (item=main.json)
ok: [EdvinToome-3] => (item=rsyslog.json)
ok: [EdvinToome-3] => (item=mysql.json)

TASK [grafana : Wait for Grafana to start] *************************************
ok: [EdvinToome-3]

TASK [grafana : Provision dashboard] *******************************************
ok: [EdvinToome-3] => (item=main.json)
ok: [EdvinToome-3] => (item=rsyslog.json)
ok: [EdvinToome-3] => (item=mysql.json)

PLAY RECAP *********************************************************************
EdvinToome-1               : ok=71   changed=0    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
EdvinToome-2               : ok=75   changed=0    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
EdvinToome-3               : ok=75   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

EdvinToome-3 | CHANGED => {
    "changed": true,
    "elapsed": 33,
    "rebooted": true
}
EdvinToome-1 | CHANGED => {
    "changed": true,
    "elapsed": 33,
    "rebooted": true
}
EdvinToome-2 | CHANGED => {
    "changed": true,
    "elapsed": 34,
    "rebooted": true
}

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [init : Update APT cache] *************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [rsyslog : Configure rsyslog] *********************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [backup : Add the user 'backup'] ******************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [backup : Create a 2048-bit SSH key] **************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [backup : Copy known hosts] ***********************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [backup : Create a directory /home/backup/restore] ************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [backup : install duplicity] **********************************************
ok: [EdvinToome-3]
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [node_exporter : Install node_exporter] ***********************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [node_exporter : prometheus-node-exporter config] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [node_exporter : Enable node exporter] ************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [users : Add the user 'juri'] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [users : Add the user 'roman'] ********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [users : juri] ************************************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [users : roman] ***********************************************************
ok: [EdvinToome-3]
ok: [EdvinToome-2]
ok: [EdvinToome-1]

PLAY [DNS server] **************************************************************

TASK [bind : Install bind9] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Start service bind9, if not started] ******************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]
ok: [EdvinToome-3]

TASK [bind : Configure access rules for DNS server] ****************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Configure conf local] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind : Configure resolv.conf] ********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Configure DB.larsenbiscuits.io] ***********************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Configure DB rev] *************************************************
skipping: [EdvinToome-1]
skipping: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind : Force flushers] ***************************************************

TASK [bind_exporter : update and install bind exporter] ************************
ok: [EdvinToome-1]
ok: [EdvinToome-3]
ok: [EdvinToome-2]

TASK [bind_exporter : install service] *****************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

TASK [bind_exporter : Enable bind exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]
ok: [EdvinToome-3]

PLAY [DNS master] **************************************************************

TASK [dns_records : Set CNAME records] *****************************************
ok: [EdvinToome-3] => (item={'key': 'grafana', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'influxdb', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'lb1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'lb2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'mysql1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'mysql2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'ns1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'ns2', 'value': 'EdvinToome-2'})
ok: [EdvinToome-3] => (item={'key': 'prometheus', 'value': 'EdvinToome-3'})
ok: [EdvinToome-3] => (item={'key': 'web1', 'value': 'EdvinToome-1'})
ok: [EdvinToome-3] => (item={'key': 'web2', 'value': 'EdvinToome-2'})

TASK [dns_records : Set A records] *********************************************
ok: [EdvinToome-3] => (item={'key': 'backup', 'value': '192.168.42.132'})

PLAY [Prometheus] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [EdvinToome-3]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-3]

TASK [nginx : NGINX config] ****************************************************
ok: [EdvinToome-3]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-3]

TASK [prometheus : update and install prometheus] ******************************
ok: [EdvinToome-3]

TASK [prometheus : prometheus args] ********************************************
ok: [EdvinToome-3]

TASK [prometheus : prometheus configuration file] ******************************
ok: [EdvinToome-3]

TASK [prometheus : start prometheus] *******************************************
ok: [EdvinToome-3]

TASK [prometheus : Install nginx] **********************************************
ok: [EdvinToome-3]

TASK [prometheus : Start service nginx, if not started] ************************
ok: [EdvinToome-3]

TASK [prometheus : Enable service nginx, and not touch the state] **************
ok: [EdvinToome-3]

TASK [nginx_exporter : update and install nginx exporter] **********************
ok: [EdvinToome-3]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
ok: [EdvinToome-3]

TASK [nginx_exporter : Enable nginx exporter] **********************************
ok: [EdvinToome-3]

PLAY [Database server] *********************************************************

TASK [mysql : Install python3-pymysql] *****************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Install mysql-server] ********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : Start service mysql, if not started] *****************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql : Enable service mysql, and not touch the state] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : mysql config] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL database] **************************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql : MySQL user] ******************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL user replication] ******************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql : MySQL read only for replica server] ******************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : update and install mysql node exporter] *****************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : create mysql user] **************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : Enable mysql exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_exporter : config mysql] *******************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql_exporter : config prometheus-mysqld-exporter] **********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : Create a directory /home/backup/mysql] ********************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql_backup : create mysql user backup] *********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : config mysql] *********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [mysql_backup : schedule MySQL dumps with Cron] ***************************
skipping: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Install keepalived] *****************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Keepalived config] ******************************************
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
[DEPRECATION WARNING]: Use 'ansible.utils.ipmath' module instead. This feature 
will be removed from ansible.netcommon in a release after 2024-01-01. 
Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Start service keepalived, if not started] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Add keepalived_script user] *********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Add keepalive script] ***************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Enable service keepalived, and not touch the state] *********
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [keepalived : Create a directory /usr/local/bin/keepalived-exporter/] *****
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : download and unzip node exporter if not exist] **************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : config keepalived exporter.service] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [keepalived : Start keepalived exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Install haproxy] ***********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Configure haproxy] *********************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Start service haproxy, if not started] *************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Install HAProxy exporter] **************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Start service prometheus-haproxy-exporter, if not started] *****
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [haproxy : Configure HAProxy exporter] ************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

PLAY [InfluxDB] ****************************************************************

TASK [influxdb : add influxdb key] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : add repository influxdb] **************************************
ok: [EdvinToome-3]

TASK [influxdb : install influxdb] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : config influxdb] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : install fping] ************************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable influxdb] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : Add the user 'pinger'] ****************************************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.service] ****************************************
ok: [EdvinToome-3]

TASK [influxdb : Create a directory /usr/local/bin/pinger/] ********************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.sh] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : Create a directory /etc/pinger/] ******************************
ok: [EdvinToome-3]

TASK [influxdb : config pinger.conf] *******************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable pinger] ************************************************
ok: [EdvinToome-3]

TASK [influxdb : install telegraf] *********************************************
ok: [EdvinToome-3]

TASK [influxdb : config telegraf] **********************************************
ok: [EdvinToome-3]

TASK [influxdb : config rsyslog] ***********************************************
ok: [EdvinToome-3]

TASK [influxdb : Enable telegraf] **********************************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : check if influxdb_exporter exist] ********************
ok: [EdvinToome-3]

TASK [influxdb_exporter : Download influxdb exporter] **************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : install service] *************************************
ok: [EdvinToome-3]

TASK [influxdb_exporter : Enable influxdb_exporter] ****************************
ok: [EdvinToome-3]

TASK [influxdb_backup : Create a directory /home/backup/influxdb] **************
ok: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
ok: [EdvinToome-3]

TASK [influxdb_backup : schedule Influxdb dumps with Cron] *********************
ok: [EdvinToome-3]

PLAY [Web server] **************************************************************

TASK [nginx : Install nginx] ***************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : Start service nginx, if not started] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : NGINX config] ****************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx : Enable service nginx, and not touch the state] *******************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : update and install nginx exporter] **********************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : Copy nginx exporter config] *****************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [nginx_exporter : Enable nginx exporter] **********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

PLAY [Agama] *******************************************************************

TASK [docker : Install docker] *************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Install agama dependency] ****************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [agama : Add the user 'agama'] ********************************************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [agama : Create a directory /opt/agama] ***********************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Download agama] **************************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Download agama docker] *******************************************
ok: [EdvinToome-1]
ok: [EdvinToome-2]

TASK [agama : Build an image and push it to a private repo] ********************
ok: [EdvinToome-2]
ok: [EdvinToome-1]

TASK [agama : Run agama container] *********************************************
ok: [EdvinToome-2] => (item=1)
ok: [EdvinToome-1] => (item=1)
ok: [EdvinToome-2] => (item=2)
ok: [EdvinToome-1] => (item=2)
ok: [EdvinToome-1] => (item=3)
ok: [EdvinToome-2] => (item=3)

PLAY [Grafana] *****************************************************************

TASK [docker : Install docker] *************************************************
ok: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/dashboards] *******
ok: [EdvinToome-3]

TASK [grafana : Create a directory /opt/grafana/provisioning/datasources] ******
ok: [EdvinToome-3]

TASK [grafana : Config grafana] ************************************************
ok: [EdvinToome-3]

TASK [grafana : Provisioning Grafana datasource] *******************************
ok: [EdvinToome-3]

TASK [grafana : Run Grafana container] *****************************************
ok: [EdvinToome-3]

TASK [grafana : Create a directory /var/lib/grafana/dashboards] ****************
ok: [EdvinToome-3]

TASK [grafana : Import dashboard] **********************************************
ok: [EdvinToome-3] => (item=main.json)
ok: [EdvinToome-3] => (item=rsyslog.json)
ok: [EdvinToome-3] => (item=mysql.json)

TASK [grafana : Wait for Grafana to start] *************************************
ok: [EdvinToome-3]

TASK [grafana : Provision dashboard] *******************************************
ok: [EdvinToome-3] => (item=main.json)
ok: [EdvinToome-3] => (item=rsyslog.json)
ok: [EdvinToome-3] => (item=mysql.json)

PLAY RECAP *********************************************************************
EdvinToome-1               : ok=71   changed=0    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
EdvinToome-2               : ok=75   changed=0    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
EdvinToome-3               : ok=75   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

T 20 dets  2022 12:39:45 EET
